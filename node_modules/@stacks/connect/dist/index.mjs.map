{"version":3,"sources":["../src/errors.ts","../src/asigna.ts","../src/providers.ts","../src/storage.ts","../src/request.ts","../src/auth.ts","../src/types/transactions.ts","../src/types/bitcoin.ts","../src/utils.ts","../src/profile/index.ts","../src/signature/index.ts","../src/signature/structuredData.ts","../src/transactions/index.ts","../src/ui.ts","../src/bitcoin/psbt.ts"],"names":["JsonRpcError","_JsonRpcError","message","code","data","cause","error","JsonRpcErrorCode","source","generateCall","payload","key","res","listener","generateAsignaMessage","AsignaIframeProvider","initializeAsignaProvider","DEFAULT_PROVIDERS","LOCAL_STORAGE_KEY","INITIAL_STORAGE","normalizeAddresses","addresses","a","_a","__objRest","setLocalStorageData","current","getLocalStorage","updated","__spreadProps","__spreadValues","bytesToHex","utf8ToBytes","clearLocalStorage","hex","bytesToUtf8","hexToBytes","disconnect","clearSelectedProviderId","UserSession","isConnected","storage","requestRaw","provider","method","params","response","createRequestWithStorage","enableLocalStorage","result","stx","btc","sortAddresses","acc","addr","request","args","options","requestArgs","opts","getProvider","shallowDefined","req","wrapResultOverrides","finalMethod","finalParams","getMethodOverrides","serializeParams","defineCustomElements","resolve","reject","element","filterProviders","getInstalledProviders","originalOverflow","closeModal","selectedProviderId","selectedProvider","getProviderFromId","proxy","createPersistProviderProxy","handleEsc","ev","approvedProviderIds","providers","p","connect","requestRawLegacy","mapOptions","mapResponse","o","r","isXverseLike","isXverse","isFordefi","isLeather","obj","value","enableOverrides","modifiedResult","base64","paramsXverse","signInputs","signRecord","input","paramsLeather","i","POST_CONDITIONS","item","postConditionToHex","Cl","shouldPersist","providerId","setSelectedProviderId","e","b","aPayment","bPayment","defaultAuthURL","isMobile","ua","authenticate","authOptions","_b","_c","_d","_e","_f","onFinish","onCancel","_userSession","userSession","getOrCreateUserSession","sessionData","address","isMainnet","btcAddress","isAddressTaproot","LOCALSTORAGE_SESSION_KEY","AppConfig","_scopes","_appDomain","_redirectPath","_manifestPath","_coreNode","_authenticatorURL","InstanceDataStore","LocalStorageStore","userData","NoSessionDataError","redirectURL","SessionDataStore","sessionOptions","_session","session","getUserData","PREFIXES","LENGTHS","index","TransactionTypes","ContractCallArgumentType","SignatureHash","getStacksProvider","getSelectedProviderId","isStacksWalletInstalled","legacyNetworkFromConnectNetwork","network","LegacyStacksNetwork","LegacyStacksMainnet","TransactionVersion","LegacyStacksTestnet","isInstance","object","clazz","connectNetworkToString","LegacyStacksDevnet","LegacyStacksMocknet","legacyCVToCV","cv","LegacyClarityType","k","v","Address","_exhaustiveCheck","removeUnserializableKeys","getDefaultProfileUpdateRequestOptions","_options","makeProfileUpdateToken","METHOD","LEGACY_UPDATE_PROFILE_OPTIONS_MAP","LEGACY_UPDATE_PROFILE_RESPONSE_MAP","openProfileUpdateRequestPopup","getDefaultSignatureRequestOptions","signMessage","LEGACY_SIGN_MESSAGE_OPTIONS_MAP","LEGACY_SIGN_MESSAGE_RESPONSE_MAP","openSignatureRequestPopup","signStructuredMessage","LEGACY_SIGN_STRUCTURED_MESSAGE_OPTIONS_MAP","LEGACY_SIGN_STRUCTURED_MESSAGE_RESPONSE_MAP","openStructuredDataSignatureRequestPopup","getUserSession","appConfig","hasAppPrivateKey","getKeys","getStxAddress","stxAddress","_network","stxAddresses","chainIdToKey","ChainId","makeContractCallToken","makeContractDeployToken","makeSTXTransferToken","makeSignTransaction","METHOD_CALL_CONTRACT","LEGACY_CALL_CONTRACT_OPTIONS_MAP","functionArgs","arg","optPostConditionMode","optPostCondition","LEGACY_CALL_CONTRACT_RESPONSE_MAP","deserializeTransaction","openContractCall","METHOD_DEPLOY_CONTRACT","LEGACY_DEPLOY_CONTRACT_OPTIONS_MAP","LEGACY_DEPLOY_CONTRACT_RESPONSE_MAP","openContractDeploy","METHOD_TRANSFER_STX","LEGACY_TRANSFER_STX_OPTIONS_MAP","LEGACY_TRANSFER_STX_RESPONSE_MAP","openSTXTransfer","METHOD_SIGN_TRANSACTION","LEGACY_SIGN_TRANSACTION_OPTIONS_MAP","LEGACY_SIGN_TRANSACTION_RESPONSE_MAP","openSignTransaction","pcs","pc","legacySerializePostCondition","mode","PostConditionMode","requestLegacy","showConnect","showSTXTransfer","showContractCall","showContractDeploy","showSignTransaction","showProfileUpdate","showSignMessage","showSignStructuredMessage","showBlockstackConnect","getDefaultPsbtRequestOptions","makePsbtToken","LEGACY_SIGN_PSBT_OPTIONS_MAP","hash","LEGACY_SIGN_PSBT_RESPONSE_MAP","openPsbtRequestPopup"],"mappings":"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","file":"index.mjs","sourcesContent":["import { JsonRpcResponseError } from './methods';\n\nexport class JsonRpcError extends Error {\n  constructor(\n    public message: string,\n    public code: number,\n    public data?: string,\n\n    public cause?: Error\n  ) {\n    super(message);\n    this.name = 'JsonRpcError';\n    this.message = message;\n    this.code = code;\n    this.data = data;\n\n    this.cause = cause;\n  }\n\n  static fromResponse(error: JsonRpcResponseError) {\n    return new JsonRpcError(error.message, error.code, error.data);\n  }\n\n  toString() {\n    return `${this.name} (${this.code}): ${this.message}${this.data ? `: ${JSON.stringify(this.data)}` : ''}`;\n  }\n}\n\n/**\n * Numeric error codes for JSON-RPC errors, used for `.code` in {@link JsonRpcError}.\n * Implementation-defined wallet errors range from `-32099` to `-32000`.\n */\nexport enum JsonRpcErrorCode {\n  // https://www.jsonrpc.org/specification#error_object\n  // > The error codes from and including -32768 to -32000 are reserved for pre-defined errors.\n\n  /** Invalid JSON received by server while parsing */\n  ParseError = -32_700,\n\n  /** Invalid Request object */\n  InvalidRequest = -32_600,\n\n  /** Method not found/available */\n  MethodNotFound = -32_601,\n\n  /** Invalid method params */\n  InvalidParams = -32_602,\n\n  /** Internal JSON-RPC error */\n  InternalError = -32_603,\n\n  // IMPLEMENTATION-DEFINED WALLET ERRORS\n  /** User rejected the request (implementation-defined wallet error) */\n  UserRejection = -32_000,\n\n  /** Address mismatch for the requested method (implementation-defined wallet error) */\n  MethodAddressMismatch = -32_001,\n\n  /** Access denied for the requested method (implementation-defined wallet error) */\n  MethodAccessDenied = -32_002,\n\n  // CUSTOM ERRORS (Custom range, not inside the JSON-RPC error code range)\n  /**\n   * Unknown external error.\n   * Error does not originate from the wallet.\n   */\n  UnknownError = -31_000,\n\n  /**\n   * User canceled the request.\n   * Error may not originate from the wallet.\n   */\n  UserCanceled = -31_001,\n}\n","const source = 'asigna-stx';\n\nconst generateCall = (payload: string, key: string) => {\n  return new Promise(res => {\n    function listener(message: MessageEvent<any>) {\n      if (message.data.source === source && message.data[key]) {\n        res(message.data[key]);\n        window.removeEventListener('message', listener);\n      }\n    }\n    window.addEventListener('message', listener);\n    window.top.postMessage(generateAsignaMessage(payload, key), '*');\n  });\n};\n\nconst AsignaIframeProvider = {\n  authenticationRequest: async (payload: string) => {\n    return generateCall(payload, 'authenticationRequest');\n  },\n  transactionRequest: async (payload: string) => {\n    return generateCall(payload, 'transactionRequest');\n  },\n};\nconst generateAsignaMessage = (payload: string, key: string) => ({ source, [key]: payload });\n\nexport const initializeAsignaProvider = () => {\n  if (typeof window === 'undefined') return;\n\n  const isAsignaIframe = !!window.top && document.referrer.endsWith('.asigna.io/');\n  if (isAsignaIframe) {\n    window['AsignaProvider'] = AsignaIframeProvider;\n  }\n};\n","import { WebBTCProvider } from '@stacks/connect-ui';\nimport { initializeAsignaProvider } from './asigna';\n\ninitializeAsignaProvider();\n\nexport const DEFAULT_PROVIDERS: WebBTCProvider[] = [\n  {\n    id: 'LeatherProvider',\n    name: 'Leather',\n    icon: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTI4IiBoZWlnaHQ9IjEyOCIgdmlld0JveD0iMCAwIDEyOCAxMjgiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMjgiIGhlaWdodD0iMTI4IiByeD0iMjYuODM4NyIgZmlsbD0iIzEyMTAwRiIvPgo8cGF0aCBkPSJNNzQuOTE3MSA1Mi43MTE0QzgyLjQ3NjYgNTEuNTQwOCA5My40MDg3IDQzLjU4MDQgOTMuNDA4NyAzNy4zNzYxQzkzLjQwODcgMzUuNTAzMSA5MS44OTY4IDM0LjIxNTQgODkuNjg3MSAzNC4yMTU0Qzg1LjUwMDQgMzQuMjE1NCA3OC40MDYxIDQwLjUzNjggNzQuOTE3MSA1Mi43MTE0Wk0zOS45MTEgODMuNDk5MUMzMC4wMjU2IDgzLjQ5OTEgMjkuMjExNSA5My4zMzI0IDM5LjA5NjkgOTMuMzMyNEM0My41MTYzIDkzLjMzMjQgNDguODY2MSA5MS41NzY0IDUxLjY1NzMgODguNDE1N0M0Ny41ODY4IDg0LjkwMzggNDQuMjE0MSA4My40OTkxIDM5LjkxMSA4My40OTkxWk0xMDIuODI5IDc5LjI4NDhDMTAzLjQxIDk1Ljc5MDcgOTUuMDM2OSAxMDUuMDM5IDgwLjg0ODQgMTA1LjAzOUM3Mi40NzQ4IDEwNS4wMzkgNjguMjg4MSAxMDEuODc4IDU5LjMzMyA5Ni4wMjQ5QzU0LjY4MSAxMDEuMTc2IDQ1Ljg0MjMgMTA1LjAzOSAzOC41MTU0IDEwNS4wMzlDMTMuMjc4NSAxMDUuMDM5IDE0LjMyNTIgNzIuODQ2MyA0MC4wMjczIDcyLjg0NjNDNDUuMzc3MSA3Mi44NDYzIDQ5LjkxMjggNzQuMjUxMSA1NS43Mjc3IDc3Ljg4TDU5LjU2NTYgNjQuNDE3N0M0My43NDg5IDYwLjA4NjQgMzUuODQwNSA0Ny45MTE4IDQzLjYzMjYgMzAuNDY5M0g1Ni4xOTI5QzQ5LjIxNSA0Mi4wNTg2IDUzLjk4MzIgNTEuNjU3OCA2Mi44MjIgNTIuNzExNEM2Ny41OTAzIDM1LjczNzIgNzcuODI0NiAyMi41MDkgOTEuNDMxNiAyMi41MDlDOTkuMTA3NCAyMi41MDkgMTA1LjE1NSAyNy41NDI4IDEwNS4xNTUgMzYuNjczN0MxMDUuMTU1IDUxLjMwNjYgODYuMDgxOSA2My4yNDcxIDcxLjY2MDcgNjQuNDE3N0w2NS43Mjk1IDg1LjM3MjFDNzIuNDc0OCA5My4yMTUzIDkxLjE5OSAxMDAuODI0IDkxLjE5OSA3OS4yODQ4SDEwMi44MjlaIiBmaWxsPSIjRjVGMUVEIi8+Cjwvc3ZnPgo=',\n\n    webUrl: 'https://leather.io',\n    chromeWebStoreUrl:\n      'https://chrome.google.com/webstore/detail/hiro-wallet/ldinpeekobnhjjdofggfgjlcehhmanlj',\n    mozillaAddOnsUrl: 'https://leather.io/install-extension',\n  },\n  {\n    id: 'XverseProviders.BitcoinProvider',\n    name: 'Xverse Wallet',\n    icon: 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2MDAiIGhlaWdodD0iNjAwIj48ZyBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPjxwYXRoIGZpbGw9IiMxNzE3MTciIGQ9Ik0wIDBoNjAwdjYwMEgweiIvPjxwYXRoIGZpbGw9IiNGRkYiIGZpbGwtcnVsZT0ibm9uemVybyIgZD0iTTQ0MCA0MzUuNHYtNTFjMC0yLS44LTMuOS0yLjItNS4zTDIyMCAxNjIuMmE3LjYgNy42IDAgMCAwLTUuNC0yLjJoLTUxLjFjLTIuNSAwLTQuNiAyLTQuNiA0LjZ2NDcuM2MwIDIgLjggNCAyLjIgNS40bDc4LjIgNzcuOGE0LjYgNC42IDAgMCAxIDAgNi41bC03OSA3OC43Yy0xIC45LTEuNCAyLTEuNCAzLjJ2NTJjMCAyLjQgMiA0LjUgNC42IDQuNUgyNDljMi42IDAgNC42LTIgNC42LTQuNlY0MDVjMC0xLjIuNS0yLjQgMS40LTMuM2w0Mi40LTQyLjJhNC42IDQuNiAwIDAgMSA2LjQgMGw3OC43IDc4LjRhNy42IDcuNiAwIDAgMCA1LjQgMi4yaDQ3LjVjMi41IDAgNC42LTIgNC42LTQuNloiLz48cGF0aCBmaWxsPSIjRUU3QTMwIiBmaWxsLXJ1bGU9Im5vbnplcm8iIGQ9Ik0zMjUuNiAyMjcuMmg0Mi44YzIuNiAwIDQuNiAyLjEgNC42IDQuNnY0Mi42YzAgNCA1IDYuMSA4IDMuMmw1OC43LTU4LjVjLjgtLjggMS4zLTIgMS4zLTMuMnYtNTEuMmMwLTIuNi0yLTQuNi00LjYtNC42TDM4NCAxNjBjLTEuMiAwLTIuNC41LTMuMyAxLjNsLTU4LjQgNTguMWE0LjYgNC42IDAgMCAwIDMuMiA3LjhaIi8+PC9nPjwvc3ZnPg==',\n\n    webUrl: 'https://xverse.app',\n    chromeWebStoreUrl:\n      'https://chrome.google.com/webstore/detail/xverse-wallet/idnnbdplmphpflfnlkomgpfbpcgelopg',\n    googlePlayStoreUrl: 'https://play.google.com/store/apps/details?id=com.secretkeylabs.xverse',\n    iOSAppStoreUrl: 'https://apps.apple.com/app/xverse-bitcoin-web3-wallet/id1552272513',\n    mozillaAddOnsUrl: 'https://www.xverse.app/download',\n  },\n  {\n    id: 'AsignaProvider',\n    name: 'Asigna Multisig',\n    icon: 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMiIgaGVpZ2h0PSIzMiIgZmlsbD0ibm9uZSI+PHBhdGggZmlsbD0iIzAwMDEwMCIgZD0iTTAgMGgzMnYzMkgweiIvPjxwYXRoIGZpbGw9InVybCgjYSkiIGQ9Ik0xNS4xMSA1LjU1YTMgMyAwIDAgMC0xLjgyIDEuM2wtLjA1LjA4LS40My43Mi0uMDcuMTEtLjUuODUtLjA1LjA5LTEuMjkgMi4xOC0uMDQuMDctLjQ3LjgtLjA2LjEtLjQ2Ljc4LS4wNy4xMS0xLjYzIDIuNzYtLjA3LjExLS4zOC42Ni0uMDUuMDgtLjczIDEuMjQtLjM1LjYtLjQuNjctLjA1LjA5TDUuMSAyMC43bC0uMTEuMTgtLjE0LjIzLS4wNy4xMy0uMzMuNTUtLjA0LjA3di4wMWExLjI2IDEuMjYgMCAwIDAtLjE0LjQ3IDEuMzEgMS4zMSAwIDAgMCAxLjI0IDEuNGgxLjVsLjA1LS4wNi4wNC0uMDYuODctMS4yMS4wNS0uMDguNzctMS4wNy4wNS0uMDcuNC0uNTcuMDUtLjA2LjI0LS4zNGExLjUyIDEuNTIgMCAwIDEgMS4zOS0uNjIgMS41IDEuNSAwIDAgMSAuNjQuMiAxLjQ3IDEuNDcgMCAwIDEgLjczIDEuMjcgMS40NCAxLjQ0IDAgMCAxLS4yNy44NGwtLjYzLjg4LS4wNS4wNy0uMzIuNDUtLjA2LjA4LS4wOC4xMi0uMTIuMTYtLjA1LjA4aDIuMTNhMi4zMiAyLjMyIDAgMCAwIDEuNzctLjk2bDEuMTgtMS42My43Ny0xLjA4IDEuMy0xLjhhMS4yNCAxLjI0IDAgMCAxIC41NS0uNDNsLjA4LS4wM2ExLjMgMS4zIDAgMCAxIC4zLS4wNiAxLjI4IDEuMjggMCAwIDEgMS4xNS41NGwuMTEuMmExLjEzIDEuMTMgMCAwIDEgLjEuNDEgMS4xOSAxLjE5IDAgMCAxLS4yMy43N2wtLjAzLjA1LS41Ny44LS43Ljk4LS4yNy4zN2ExLjIyIDEuMjIgMCAwIDAtLjIuNSAxLjA1IDEuMDUgMCAwIDAtLjAyLjIzdi4wNmExLjE3IDEuMTcgMCAwIDAgLjE0LjQzbC4wMi4wNS4wNy4xYTEuNDQgMS40NCAwIDAgMCAuMS4xMWwuMDUuMDYuMDEuMDFhMS44IDEuOCAwIDAgMCAuMTQuMWMwIC4wMi4wMi4wMy4wNC4wM2ExIDEgMCAwIDAgLjA4LjA1bC4wNy4wNGExLjI1IDEuMjUgMCAwIDAgLjUuMWg2LjljLjEgMCAuMi0uMDEuMjktLjAzbC4wNi0uMDJhMS4yNyAxLjI3IDAgMCAwIC4yNy0uMS41Ny41NyAwIDAgMCAuMDctLjAzIDEuMjEgMS4yMSAwIDAgMCAuMjYtLjE5bC4wOC0uMDdhLjkyLjkyIDAgMCAwIC4xNS0uMTkgMS41NSAxLjU1IDAgMCAwIC4wOS0uMTdsLjAyLS4wNWExLjIyIDEuMjIgMCAwIDAgLjA4LS4yNnYtLjA0bC4wMi0uMDh2LS4wOGExLjMyIDEuMzIgMCAwIDAtLjItLjc0bC0xLjYtMi42NC0uMDYtLjEtLjItLjMyLS4zMy0uNTR2LS4wMWwtLjA1LS4wOC0xLjMtMi4xNS0uMDctLjEtLjA0LS4wNi0uOC0xLjMyLS4wNC0uMDctLjItLjM0LS4xLS4xNC0uMS0uMTYtLjUzLS45LS4xMy0uMi0uMDktLjE0LTIuMTctMy41Ny0uMDQtLjA3LS43Mi0xLjE5LS4wNS0uMDctLjQtLjY1YTIuNjUgMi42NSAwIDAgMC0uMy0uNCAyLjk2IDIuOTYgMCAwIDAtLjk3LS43NCAzLjA0IDMuMDQgMCAwIDAtMS4zLS4zYy0uMjUgMC0uNS4wNC0uNzQuMVoiLz48cGF0aCBmaWxsPSJ1cmwoI2IpIiBkPSJNMTkgMTYuM2E1LjQ1IDUuNDUgMCAwIDAtLjgzIDEuNTZsLS4wNC4xNWExLjM2IDEuMzYgMCAwIDEgLjI4LS4xNiAxLjI0IDEuMjQgMCAwIDEgLjM4LS4wOGguMWExLjI4IDEuMjggMCAwIDEgMS4wNS41NGMuMDQuMDYuMDguMTMuMS4yYTEuMjQgMS4yNCAwIDAgMSAuMDkuMjcgMS4xOSAxLjE5IDAgMCAxLS4yLjkxbC0uMDQuMDUtLjU3Ljc5LS43Ljk5LS4yNy4zN2ExLjIzIDEuMjMgMCAwIDAtLjIuNDIgMS4wNiAxLjA2IDAgMCAwLS4wMi4zMXYuMDZhMS4xNyAxLjE3IDAgMCAwIC4xNi40Ny45My45MyAwIDAgMCAuMDcuMSAxLjUgMS41IDAgMCAwIC4xLjEybC4wNS4wNmguMDFhMS45NCAxLjk0IDAgMCAwIC4wOS4wOCAxIDEgMCAwIDAgLjE3LjFsLjA3LjA0YTEuMjUgMS4yNSAwIDAgMCAuNS4xaDYuOWMuMSAwIC4yIDAgLjI4LS4wMmwuMDctLjAyYTEuMzIgMS4zMiAwIDAgMCAuMzQtLjEzbC4xNi0uMS4wMy0uMDNhMS4yOSAxLjI5IDAgMCAwIC4yLS4yIDIuNDMgMi40MyAwIDAgMCAuMTItLjE3Yy4wMy0uMDMuMDUtLjA4LjA3LS4xMmwuMDItLjA1YTEuMjEgMS4yMSAwIDAgMCAuMDktLjN2LS4wOGwuMDEtLjA5YTEuMzIgMS4zMiAwIDAgMC0uMi0uNzNsLTEuNi0yLjY0LS4wNi0uMS0uMi0uMzItLjMzLS41NHYtLjAybC0uMDUtLjA3LTEuMy0yLjE1LS4xMi0uMDctLjA3LS4wNGE0Ljk0IDQuOTQgMCAwIDAtMi40Ni0uNjdjLTEuMDMgMC0xLjc2LjU3LTIuMjYgMS4yWiIvPjxwYXRoIGZpbGw9IiNmZmYiIGQ9Ik0xMi4yOSAyMS4wOGMwIC4yOS0uMDkuNTgtLjI3Ljg0bC0xLjMxIDEuODRIN2wyLjUyLTMuNTNhMS41NCAxLjU0IDAgMCAxIDIuMS0uMzZjLjQzLjI4LjY2Ljc0LjY2IDEuMloiLz48cGF0aCBmaWxsPSIjMDAwIiBkPSJNMTEuMTYgMjEuMjVhLjU2LjU2IDAgMCAxLS41Ny41NS41Ni41NiAwIDAgMS0uNTctLjU2LjU2LjU2IDAgMCAxIC41Ny0uNTUuNTYuNTYgMCAwIDEgLjU3LjU2WiIvPjxkZWZzPjxsaW5lYXJHcmFkaWVudCBpZD0iYSIgeDE9IjE1LjIzIiB4Mj0iMTkuMyIgeTE9IjI1Ljc4IiB5Mj0iNi4xMSIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiPjxzdG9wIHN0b3AtY29sb3I9IiM2NTIyRjQiLz48c3RvcCBvZmZzZXQ9Ii41NSIgc3RvcC1jb2xvcj0iIzlCNkJGRiIvPjxzdG9wIG9mZnNldD0iMSIgc3RvcC1jb2xvcj0iI0E1ODVGRiIvPjwvbGluZWFyR3JhZGllbnQ+PGxpbmVhckdyYWRpZW50IGlkPSJiIiB4MT0iMjIuNTkiIHgyPSIyNC44IiB5MT0iMjQuNzEiIHkyPSIxNS41MyIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiPjxzdG9wIHN0b3AtY29sb3I9IiM0MjFGOEIiLz48c3RvcCBvZmZzZXQ9Ii41NSIgc3RvcC1jb2xvcj0iIzcyMzBGRiIvPjxzdG9wIG9mZnNldD0iMSIgc3RvcC1jb2xvcj0iIzk3NzNGRiIvPjwvbGluZWFyR3JhZGllbnQ+PC9kZWZzPjwvc3ZnPg==',\n\n    webUrl: 'https://asigna.io',\n    chromeWebStoreUrl: 'https://stx.asigna.io/',\n  },\n  {\n    id: 'FordefiProviders.UtxoProvider',\n    name: 'Fordefi',\n\n    icon: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDIiIGhlaWdodD0iNDIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CiAgPHBhdGggZmlsbD0iIzEwMTExNCIgZD0iTTAgMGg0MnY0MkgweiIvPgogIDxwYXRoIGQ9Ik0xOS40NyAyNi44OUg1djMuNTdhNC41NyA0LjU3IDAgMCAwIDQuNTggNC41N2g1LjgzbDQuMDYtOC4xNFoiIGZpbGw9IiM3OTk0RkYiLz4KICA8cGF0aCBkPSJNNSAxNy40aDI3LjU4bC0zLjIgNi43OEg1VjE3LjRaIiBmaWxsPSIjNDg2REZGIi8+CiAgPHBhdGggZD0iTTE0LjY3IDdINXY3LjY4aDMzVjdoLTkuNjd2NS43NGgtMlY3aC05LjY3djUuNzRoLTEuOTlWN1oiIGZpbGw9IiM1Q0QxRkEiLz4KPC9zdmc+Cg==',\n    webUrl: 'https://www.fordefi.com/',\n    chromeWebStoreUrl:\n      'https://chromewebstore.google.com/detail/fordefi/hcmehenccjdmfbojapcbcofkgdpbnlle',\n  },\n];\n","import { bytesToHex, bytesToUtf8, hexToBytes, utf8ToBytes } from '@stacks/common';\nimport { clearSelectedProviderId } from '@stacks/connect-ui';\nimport { UserSession } from './auth';\nimport { AddressEntry } from './methods';\n\nexport const LOCAL_STORAGE_KEY = '@stacks/connect';\n\nexport interface StorageData {\n  addresses: {\n    stx: Omit<AddressEntry, 'publicKey'>[];\n    btc: Omit<AddressEntry, 'publicKey'>[];\n  };\n  updatedAt?: number;\n  version: string;\n}\n\n/** @internal */\nconst INITIAL_STORAGE: StorageData = {\n  addresses: {\n    stx: [],\n    btc: [],\n  },\n  version: '0.0.1',\n};\n\n/**\n * @internal Helper to deduplicate address entries and strip sensitive data\n */\nexport const normalizeAddresses = (\n  addresses: AddressEntry[]\n): Omit<AddressEntry, 'publicKey'>[] => {\n  const deduped = [...new Map(addresses.map(a => [a.address, a])).values()];\n  return deduped.map(({ ...a }) => {\n    if ('publicKey' in a) delete a.publicKey;\n    if ('derivationPath' in a) delete a.derivationPath;\n    if ('tweakedPublicKey' in a) delete a.tweakedPublicKey;\n    return a;\n  });\n};\n\n/**\n * @internal Helper to safely store data in localStorage\n */\nexport function setLocalStorageData(data: {\n  addresses?: { stx?: AddressEntry[]; btc?: AddressEntry[] };\n}) {\n  try {\n    const existing = getLocalStorage();\n    const current: StorageData = existing || INITIAL_STORAGE;\n\n    const updated = {\n      ...current,\n      updatedAt: Date.now(),\n      addresses: {\n        ...current.addresses,\n        ...(data.addresses && {\n          stx:\n            data.addresses.stx &&\n            normalizeAddresses([\n              ...(current.addresses.stx as AddressEntry[]),\n              ...data.addresses.stx,\n            ]),\n          btc:\n            data.addresses.btc &&\n            normalizeAddresses([\n              ...(current.addresses.btc as AddressEntry[]),\n              ...data.addresses.btc,\n            ]),\n        }),\n      },\n    };\n\n    localStorage.setItem(LOCAL_STORAGE_KEY, bytesToHex(utf8ToBytes(JSON.stringify(updated))));\n  } catch (error) {\n    console.warn('Failed to store data in localStorage:', error);\n  }\n}\n\n/**\n * Clears all stored connect data from localStorage\n */\nexport function clearLocalStorage() {\n  try {\n    localStorage.removeItem(LOCAL_STORAGE_KEY);\n  } catch (error) {\n    console.warn('Failed to clear localStorage:', error);\n  }\n}\n\n/**\n * Gets the current connect data from localStorage\n */\nexport function getLocalStorage(): StorageData | null {\n  try {\n    const hex = localStorage.getItem(LOCAL_STORAGE_KEY);\n    return hex ? JSON.parse(bytesToUtf8(hexToBytes(hex))) : null;\n  } catch (error) {\n    console.warn('Failed to get data from localStorage:', error);\n    return null;\n  }\n}\n\n/** Disconnect selected wallet, clear session data and potentially clear local storage. */\nexport function disconnect() {\n  clearSelectedProviderId();\n  clearLocalStorage();\n  new UserSession().store.deleteSessionData();\n}\n\n/**\n * Checks if the user is connected.\n * Aka has successfully connected to a wallet and received an address.\n * This requires the {@link request} method to have been called with `enableLocalStorage: true`.\n */\nexport function isConnected(): boolean {\n  const storage = getLocalStorage();\n  return storage?.addresses.stx.length > 0 || storage?.addresses.btc.length > 0;\n}\n","import { base64 } from '@scure/base';\nimport { bytesToHex, hexToBytes } from '@stacks/common';\nimport {\n  getInstalledProviders,\n  getProvider,\n  getProviderFromId,\n  setSelectedProviderId,\n  WbipProvider,\n} from '@stacks/connect-ui';\nimport { defineCustomElements } from '@stacks/connect-ui/loader';\nimport { Cl, PostCondition, postConditionToHex } from '@stacks/transactions';\nimport { JsonRpcError, JsonRpcErrorCode } from './errors';\nimport {\n  AddressEntry,\n  MethodParams,\n  MethodParamsRaw,\n  MethodResult,\n  MethodResultRaw,\n  Methods,\n  MethodsRaw,\n  SendTransferParams,\n} from './methods';\nimport { DEFAULT_PROVIDERS } from './providers';\nimport { setLocalStorageData } from './storage';\nimport { StacksProvider } from './types';\n\nexport interface ConnectRequestOptions {\n  /**\n   * The provider to use for the request.\n   * If none is provided the UI will be shown.\n   * Defaults to the previously selected provider (unless `forceWalletSelect` is `true`).\n   */\n  provider?: StacksProvider;\n\n  /**\n   * Forces the user to select a wallet.\n   * Defaults to `false`.\n   */\n  forceWalletSelect?: boolean;\n\n  /**\n   * Persist the selected wallet across requests.\n   * Defaults to `true`.\n   */\n  persistWalletSelect?: boolean;\n\n  /**\n   * Adds manual request rewriting to make different providers behave more closely to SIP-030 / WBIPs.\n   * Defaults to `true`.\n   */\n  enableOverrides?: boolean;\n\n  /**\n   * Enable local storage caching of addresses.\n   * Defaults to `true`.\n   */\n  enableLocalStorage?: boolean;\n\n  /**\n   * The default wallets to display in the modal.\n   * Defaults to some known popular wallets.\n   */\n  defaultProviders?: WbipProvider[];\n\n  /**\n   * A list of provider IDs that are approved to be shown in the Stacks Connect modal.\n   * If not provided, all default and installed providers will be shown.\n   */\n  approvedProviderIds?: string[];\n\n  // todo: maybe add callbacks, if set use them instead of throwing errors\n}\n\nexport async function requestRaw<M extends keyof MethodsRaw>(\n  provider: StacksProvider,\n  method: M,\n  params?: MethodParamsRaw<M>\n): Promise<MethodResultRaw<M>> {\n  try {\n    const response = await provider.request(method, params);\n    if ('error' in response) throw JsonRpcError.fromResponse(response.error);\n\n    return response.result;\n  } catch (error) {\n    if (error instanceof JsonRpcError) throw error;\n    if ('jsonrpc' in error) throw JsonRpcError.fromResponse(error.error);\n\n    const code = error.code ?? JsonRpcErrorCode.UnknownError;\n    throw new JsonRpcError(error.message, code, error.data, error);\n  }\n}\n\n/**\n * @internal Helper function that wraps requestRaw with local storage support\n */\nfunction createRequestWithStorage(enableLocalStorage: boolean): typeof requestRaw {\n  if (!enableLocalStorage) return requestRaw;\n\n  return async function requestRawWithStorage<M extends keyof MethodsRaw>(\n    provider: StacksProvider,\n    method: M,\n    params?: MethodParamsRaw<M>\n  ): Promise<MethodResultRaw<M>> {\n    const result = await requestRaw(provider, method, params);\n    if (\n      (method === 'getAddresses' || (method as string) === 'wallet_connect') &&\n      'addresses' in result\n    ) {\n      const { stx, btc } = sortAddresses(result.addresses).reduce(\n        (acc, addr) => {\n          acc[addr.address.startsWith('S') ? 'stx' : 'btc'].push(addr);\n          return acc;\n        },\n        { stx: [], btc: [] }\n      );\n\n      setLocalStorageData({ addresses: { stx, btc } });\n    }\n    return result;\n  };\n}\n\n/**\n * The main `request` method for interacting with wallets.\n * This method adds automatic error handling, request parameter serialization, and optional local storage.\n * For more advanced use cases, consider using the {@link requestRaw} method directly.\n *\n * @example\n * ```\n * // Send BTC\n * const result = await request('sendTransfer', {\n *   recipients: [{\n *     address: 'bc1...',\n *     amount: 100_000_000n, // 1 BTC = 100,000,000 sats\n *   }],\n * });\n * ```\n *\n * @example\n * ```\n * // Optional features\n * const result = await request({\n *   provider: MyCustomProvider,\n *   defaultProviders: [MyCustomProvider, ...],\n *   forceWalletSelect: false,\n *   persistWalletSelect: true,\n *   enableOverrides: true,\n *   enableLocalStorage: true,\n * }, 'method', params);\n * ```\n */\nexport async function request<M extends keyof Methods>(\n  method: M,\n  params?: MethodParams<M>\n): Promise<MethodResult<M>>;\nexport async function request<M extends keyof Methods>(\n  options: ConnectRequestOptions,\n  method: M,\n  params?: MethodParams<M>\n): Promise<MethodResult<M>>;\nexport async function request<M extends keyof Methods>(\n  ...args:\n    | [method: M, params?: MethodParams<M>]\n    | [options: ConnectRequestOptions, method: M, params?: MethodParams<M>]\n): Promise<MethodResult<M>> {\n  const { options, method, params } = requestArgs(args);\n\n  // Default options\n  const opts = Object.assign(\n    {\n      provider: getProvider(),\n      defaultProviders: DEFAULT_PROVIDERS,\n\n      forceWalletSelect: false,\n      persistWalletSelect: true,\n      enableOverrides: true,\n      enableLocalStorage: true,\n    },\n    shallowDefined(options)\n  );\n\n  const req = wrapResultOverrides(\n    opts.enableOverrides,\n    createRequestWithStorage(opts.enableLocalStorage)\n  );\n\n  // WITHOUT UI\n  if (opts.provider && !opts.forceWalletSelect) {\n    const { method: finalMethod, params: finalParams } = getMethodOverrides(\n      opts.provider,\n      method,\n      params,\n      opts.enableOverrides\n    );\n    return await req(opts.provider, finalMethod as any, serializeParams(finalParams));\n  }\n\n  // WITH UI\n  if (typeof window === 'undefined') return undefined; // don't throw for SSR contexts\n\n  void defineCustomElements(window);\n\n  return new Promise((resolve, reject) => {\n    const element = document.createElement('connect-modal');\n    element.defaultProviders = filterProviders(opts.approvedProviderIds, opts.defaultProviders);\n    element.installedProviders = filterProviders(\n      opts.approvedProviderIds,\n      getInstalledProviders(opts.defaultProviders)\n    );\n\n    const originalOverflow = document.body.style.overflow;\n    document.body.style.overflow = 'hidden';\n\n    const closeModal = () => {\n      element.remove();\n      document.body.style.overflow = originalOverflow;\n    };\n\n    element.callback = (selectedProviderId: string | undefined) => {\n      closeModal();\n\n      const selectedProvider = getProviderFromId(selectedProviderId);\n\n      const { method: finalMethod, params: finalParams } = getMethodOverrides(\n        selectedProvider,\n        method,\n        params,\n        opts.enableOverrides\n      );\n\n      const proxy = createPersistProviderProxy(opts.persistWalletSelect, selectedProviderId);\n      resolve(req(selectedProvider, finalMethod as any, serializeParams(finalParams)).then(proxy));\n    };\n\n    element.cancelCallback = () => {\n      closeModal();\n      reject(new JsonRpcError('User canceled the request', JsonRpcErrorCode.UserCanceled));\n    };\n\n    document.body.appendChild(element);\n\n    const handleEsc = (ev: KeyboardEvent) => {\n      if (ev.key !== 'Escape') return;\n      document.removeEventListener('keydown', handleEsc);\n      element.remove();\n      reject(new JsonRpcError('User canceled the request', JsonRpcErrorCode.UserCanceled));\n    };\n    document.addEventListener('keydown', handleEsc);\n  });\n}\n\n/** @internal */\nfunction requestArgs<M extends keyof Methods>(\n  args:\n    | [method: M, params?: MethodParams<M>]\n    | [options: ConnectRequestOptions, method: M, params?: MethodParams<M>]\n): {\n  method: M;\n  params?: MethodParams<M>;\n  options?: ConnectRequestOptions;\n} {\n  if (typeof args[0] === 'string') return { method: args[0], params: args[1] as MethodParams<M> };\n  return { options: args[0], method: args[1] as M, params: args[2] };\n}\n\n/** @internal */\nfunction filterProviders(approvedProviderIds: string[], providers: WbipProvider[]): WbipProvider[] {\n  if (!approvedProviderIds) return providers;\n  return providers.filter(p => approvedProviderIds.includes(p.id));\n}\n\n/**\n * Initiate a wallet connection and request addresses.\n * Alias for `request` to `getAddresses` with `forceWalletSelect: true`.\n */\nexport function connect(options?: ConnectRequestOptions & MethodParams<'getAddresses'>) {\n  const params = options && 'network' in options ? { network: options.network } : undefined;\n  return request({ ...options, forceWalletSelect: true }, 'getAddresses', params);\n}\n\n/**\n * **Note:** Higher order function!\n * @internal Legacy non-UI request.\n */\nexport function requestRawLegacy<M extends keyof Methods, O, R>(\n  method: M,\n  mapOptions: (options: O) => MethodParams<M>,\n  mapResponse: (response: MethodResult<M>) => R\n) {\n  return (options: O, provider?: StacksProvider) => {\n    if (!provider) throw new Error('[Connect] No installed Stacks wallet found');\n\n    const params = mapOptions(options);\n\n    // Manual cast, since TypeScipt can't infer generic type of options\n    const o = options as {\n      onCancel?: (error?: Error) => void;\n      onFinish?: (response: R) => void;\n    };\n\n    const { method: finalMethod, params: finalParams } = getMethodOverrides(\n      provider,\n      method,\n      params\n    );\n\n    void requestRaw(provider, finalMethod as any, serializeParams(finalParams))\n      .then(response => {\n        const r = mapResponse(response);\n        o.onFinish?.(r);\n      })\n      .catch(o.onCancel);\n  };\n}\n\n// todo: strip params that might be unserializable or privacy sensitive, e.g.\n// appDetails?: AuthOptions['appDetails'];\n// authOrigin?: string;\n// network?: ConnectNetwork;\n// stxAddress?: string;\n// userSession?: UserSession;\n// onFinish?: ProfileUpdateFinished;\n// onCancel?: ProfileUpdateCanceled;\n\nfunction isXverseLike(provider: StacksProvider): boolean {\n  return isXverse(provider) || isFordefi(provider);\n}\n\nfunction isXverse(provider: StacksProvider): boolean {\n  return (\n    // Best effort detection for Xverse\n    'signMultipleTransactions' in provider &&\n    'createRepeatInscriptions' in provider &&\n    !provider?.['isLeather'] &&\n    !provider?.['isFordefi']\n  );\n}\n\nfunction isFordefi(provider: StacksProvider): boolean {\n  return 'isFordefi' in provider && !!provider.isFordefi;\n}\n\nfunction isLeather(provider: StacksProvider): boolean {\n  return 'isLeather' in provider && !!provider.isLeather;\n}\n\nfunction shallowDefined<T extends object>(obj: T): Partial<T> {\n  if (obj === undefined) return {};\n  const result: Partial<T> = {};\n  for (const [key, value] of Object.entries(obj)) {\n    if (value !== undefined) result[key as keyof T] = value;\n  }\n  return result;\n}\n\n/** @internal Higher-order function for proxying request results with overrides */\nfunction wrapResultOverrides<\n  M extends keyof MethodsRaw,\n  P extends MethodParamsRaw<M>,\n  R extends MethodResultRaw<M>,\n>(\n  enableOverrides: boolean,\n  request: (provider: StacksProvider, method: M, params?: P) => Promise<R>\n) {\n  if (!enableOverrides) return request;\n\n  return async (provider: StacksProvider, method: M, params?: P): Promise<R> => {\n    const result = await request(provider, method, params);\n\n    const modifiedResult = { ...result };\n\n    // Handle txId/txid case variation (Fordefi returns `txId`, others return `txid`)\n    if (result !== null && 'txId' in result && result.txId && !('txid' in modifiedResult)) {\n      (modifiedResult as any).txid = result.txId;\n    }\n\n    // Handle Leather returning `hex` instead of `psbt` (base64 encoded)\n    if (\n      result !== null &&\n      'hex' in result &&\n      result.hex &&\n      typeof result.hex === 'string' &&\n      !('psbt' in modifiedResult)\n    ) {\n      (modifiedResult as any).psbt = base64.encode(hexToBytes(result.hex));\n    }\n\n    return modifiedResult;\n  };\n}\n\nfunction getMethodOverrides<M extends keyof Methods>(\n  provider: StacksProvider,\n  method: M,\n  params?: MethodParams<M>,\n  enableOverrides: boolean = true\n): { method: string; params: any } {\n  if (!enableOverrides) return { method, params };\n\n  // Xverse-ish wallets\n  if (\n    isXverseLike(provider) &&\n    // Permission granting method\n    ['getAddresses', 'stx_getAddresses'].includes(method)\n  ) {\n    return { method: 'wallet_connect', params };\n  }\n\n  // Xverse-ish `sendTransfer`\n  if (isXverseLike(provider) && method === 'sendTransfer') {\n    const paramsXverse = {\n      ...params,\n      recipients: (params as SendTransferParams).recipients.map(r => ({\n        ...r,\n        amount: Number(r.amount), // Xverse expects amount as number\n      })),\n      network: undefined, // strip network until Xverse adds it as optional\n    };\n    return { method, params: paramsXverse };\n  }\n\n  // Xverse-ish `signPsbt`\n  if (isXverseLike(provider) && method === 'signPsbt') {\n    const signInputs = (params as MethodParams<'signPsbt'>).signInputs;\n    if (!signInputs) return { method, params };\n\n    // Transform array of SignInputsByAddress into Record<string, number[]>\n    const signRecord: Record<string, number[]> = {};\n    for (const input of signInputs) {\n      if (typeof input === 'number') continue; // Skip plain numbers\n      if (!input.address) continue; // Skip entries without address\n\n      if (!signRecord[input.address]) signRecord[input.address] = [];\n\n      signRecord[input.address].push(input.index);\n    }\n\n    const paramsXverse = {\n      psbt: (params as MethodParams<'signPsbt'>).psbt,\n      signInputs: signRecord,\n      broadcast: (params as MethodParams<'signPsbt'>).broadcast,\n      // todo: add `network` when Xverse supports it\n    };\n    return { method, params: paramsXverse };\n  }\n\n  // Leather `sendTransfer`\n  if (isLeather(provider) && method === 'sendTransfer') {\n    const paramsLeather = {\n      ...params,\n      recipients: (params as SendTransferParams).recipients.map(r => ({\n        ...r,\n        amount: r.amount.toString(), // Leather expects amount as string\n      })),\n    };\n    return { method, params: paramsLeather };\n  }\n\n  // Leather `signPsbt`\n  if (isLeather(provider) && method === 'signPsbt') {\n    const paramsLeather = {\n      hex: bytesToHex(base64.decode((params as MethodParams<'signPsbt'>).psbt)),\n      signAtIndex: (params as MethodParams<'signPsbt'>).signInputs.map(i => {\n        if (typeof i === 'number') return i;\n        return i.index;\n      }),\n      allowedSighash: (params as MethodParams<'signPsbt'>).allowedSighash,\n      broadcast: (params as MethodParams<'signPsbt'>).broadcast,\n      network: (params as MethodParams<'signPsbt'>).network,\n    };\n    return { method, params: paramsLeather };\n  }\n\n  return { method, params };\n}\n\nconst POST_CONDITIONS = [\n  'stx-postcondition',\n  'ft-postcondition',\n  'nft-postcondition',\n] satisfies PostCondition['type'][];\n\n/**\n * @internal\n * Simple function for serializing clarity object values to hex strings, in case wallets don't support them.\n */\nexport function serializeParams<M extends keyof Methods>(params: MethodParams<M>): MethodParams<M> {\n  if (!params || typeof params !== 'object') return params;\n\n  const result = { ...params };\n\n  for (const [key, value] of Object.entries(params)) {\n    // Handle bigint values\n    if (typeof value === 'bigint') {\n      result[key] = value.toString();\n      continue;\n    }\n\n    // Keep original value, don't override\n    if (!value) continue;\n\n    // Handle array of things\n    if (Array.isArray(value)) {\n      result[key] = value.map(item => {\n        if (typeof item === 'bigint') return item.toString();\n        if (!item || typeof item !== 'object' || !('type' in item)) return item;\n        if (POST_CONDITIONS.includes(item.type)) return postConditionToHex(item);\n        return Cl.serialize(item);\n      });\n      continue;\n    }\n\n    // Handle things\n    if (typeof value === 'object' && 'type' in value) {\n      result[key] = POST_CONDITIONS.includes(value.type)\n        ? // Post condition\n          postConditionToHex(value)\n        : // Clarity value\n          Cl.serialize(value);\n    }\n  }\n\n  return result;\n}\n\n/** @internal Higher order function for persisting the selected provider */\nfunction createPersistProviderProxy(shouldPersist: boolean, providerId: string) {\n  return function persistProvider<T>(result: T) {\n    if (shouldPersist) {\n      try {\n        setSelectedProviderId(providerId);\n      } catch (e) {\n        // ignore errors\n      }\n    }\n\n    return result;\n  };\n}\n\n/** @internal */\nfunction sortAddresses(addresses: AddressEntry[]) {\n  return addresses.slice().sort((a, b) => {\n    const aPayment = 'purpose' in a && a.purpose === 'payment';\n    const bPayment = 'purpose' in b && b.purpose === 'payment';\n\n    // Move payment addresses to the beginning\n    if (aPayment && !bPayment) return -1;\n    if (!aPayment && bPayment) return 1;\n    return 0;\n  });\n}\n","import { NoSessionDataError } from '@stacks/common';\nimport { request } from './request';\nimport { AuthOptions, StacksProvider } from './types';\n\n/** @deprecated Not used anymore. */\nexport const defaultAuthURL = 'https://app.blockstack.org';\n\nif (typeof window !== 'undefined') {\n  window.__CONNECT_VERSION__ = '__VERSION__'; // replaced via tsup esbuildOptions\n}\n\n/** @deprecated Will be marked as internal going forward. */\nexport const isMobile = () => {\n  const ua = navigator.userAgent;\n  if (/android/i.test(ua)) {\n    return true;\n  }\n  if (/iPad|iPhone|iPod/.test(ua)) {\n    return true;\n  }\n  return /windows phone/i.test(ua);\n};\n\n/**\n * Special `authenticate` legacy request, to store addresses in userSession matching legacy behavior.\n * @internal Legacy UI request.\n */\nexport const authenticate = async (authOptions: AuthOptions, provider?: StacksProvider) => {\n  const { onFinish, onCancel, userSession: _userSession } = authOptions;\n\n  const userSession = getOrCreateUserSession(_userSession);\n  if (userSession.isUserSignedIn()) userSession.signUserOut();\n\n  try {\n    const method = 'getAddresses';\n    const response = await request({ provider, forceWalletSelect: true }, method);\n\n    const sessionData = userSession.store.getSessionData();\n\n    // Ensure user data structure exists\n    sessionData.userData ??= { profile: {} };\n    sessionData.userData.profile ??= {};\n    sessionData.userData.profile.stxAddress ??= {\n      mainnet: '',\n      testnet: '',\n    };\n\n    // Take first STX address and use it for legacy connect user session storing.\n    const address = response.addresses\n      .find(a => a?.symbol === 'STX' || a.address.startsWith('S'))\n      .address.toUpperCase();\n    const isMainnet = address[1] === 'P' || address[1] === 'M';\n\n    Object.assign(sessionData.userData.profile.stxAddress, {\n      [isMainnet ? 'mainnet' : 'testnet']: address,\n    });\n\n    // Take first BTC address and use it for legacy connect user session storing.\n    const btcAddress = response.addresses.find(a => {\n      if (a?.address?.startsWith('S')) return false;\n      if (a['purpose'] === 'payment') return true;\n\n      // If it's taproot, only select it if no non-taproot addresses exist\n      if (isAddressTaproot(a?.address)) {\n        const onlyTaprootAddressesExist = response.addresses.every(\n          addr => addr?.address?.startsWith('S') || isAddressTaproot(addr?.address)\n        );\n        return onlyTaprootAddressesExist;\n      }\n\n      return true;\n    })?.address;\n    if (btcAddress) sessionData.userData.profile.btcAddress = btcAddress;\n\n    userSession.store.setSessionData(sessionData);\n\n    onFinish?.({ userSession, authResponsePayload: sessionData.userData });\n  } catch (error) {\n    console.error('[Connect] Error during auth request', error);\n    onCancel?.(error);\n  }\n};\n\n// Legacy User Session, User Data, etc.\n\n/** @deprecated Update to the latest `request` RPC methods. It's not recommended to use the UserSession. */\nexport const LOCALSTORAGE_SESSION_KEY = 'blockstack-session';\n\n/**\n * Semi-compatible `AppConfig` type for configuring `UserSession`.\n *\n * @deprecated Update to the latest `request` RPC methods. It's not recommended to use the UserSession.\n */\nexport class AppConfig {\n  // Copied over from legacy @stacks/auth\n  constructor(\n    _scopes?: any,\n    _appDomain?: any,\n    _redirectPath?: string,\n    _manifestPath?: string,\n    _coreNode?: string,\n    _authenticatorURL?: string\n  ) {}\n}\n\n/**\n * Semi-compatible `SessionOptions` type for accessing `userData`.\n *\n * @deprecated Update to the latest `request` RPC methods. It's not recommended to use the UserSession.\n */\nexport interface SessionOptions {\n  userData?: UserData;\n  localStorageKey?: string;\n  storeOptions?: {\n    localStorageKey?: string;\n  };\n}\n\n/**\n * Semi-compatible `SessionData` type for accessing `userData`.\n *\n * @deprecated Update to the latest `request` RPC methods. It's not recommended to use the UserSession.\n */\nexport interface SessionData {\n  userData?: UserData;\n}\n\n/**\n * Semi-compatible `UserSession` type for accessing `userData`.\n *\n * @deprecated Update to the latest `request` RPC methods. It's not recommended to use the UserSession.\n */\nexport class UserSession {\n  // Copied over from legacy @stacks/auth\n  appConfig: any;\n\n  store: SessionDataStore;\n\n  /**\n   * UserSession might still work for some use cases, but it's not recommended.\n   *\n   * @deprecated Update to the latest `request` RPC methods.\n   */\n  constructor(options?: { appConfig?: any; sessionStore?: any; sessionOptions?: SessionOptions }) {\n    if (options?.appConfig) this.appConfig = options.appConfig;\n\n    if (typeof window === 'undefined' && typeof self === 'undefined') {\n      // not running in browser\n      this.store = new InstanceDataStore();\n    } else {\n      // running in browser\n      this.store = new LocalStorageStore();\n    }\n  }\n\n  /** @deprecated No-op. Update to the latest `request` RPC methods. */\n  makeAuthRequestToken() {}\n\n  /** @deprecated No-op. Update to the latest `request` RPC methods. */\n  generateAndStoreTransitKey() {}\n\n  /** @deprecated No-op. Update to the latest `request` RPC methods. */\n  getAuthResponseToken() {}\n\n  /** @deprecated No-op. Update to the latest `request` RPC methods. */\n  isSignInPending() {\n    return false;\n  }\n\n  /**\n   * Check if a user is currently signed in.\n   *\n   * @returns {Boolean} `true` if the user is signed in (aka connected), `false` if not.\n   */\n  isUserSignedIn() {\n    return !!this.store.getSessionData().userData;\n  }\n\n  /**\n   * Try to process any pending sign in request by returning a `Promise` that resolves\n   * to the user data object if the sign in succeeds.\n   *\n   * @returns {Promise} that resolves to the user data object if successful and rejects\n   * if handling the sign in request fails or there was no pending sign in request.\n   */\n  async handlePendingSignIn(): Promise<UserData> {\n    return Promise.resolve(this.loadUserData());\n  }\n\n  /**\n   * Retrieves the user data object. The user's profile is stored in the key [[Profile]].\n   *\n   * @returns {Object} User data object.\n   */\n  loadUserData() {\n    const userData = this.store.getSessionData().userData;\n    if (!userData) throw new NoSessionDataError('No user data found. Did the user sign in?');\n    return userData;\n  }\n\n  /** @deprecated No-op. Update to the latest `request` RPC methods. */\n  encryptContent() {}\n\n  /** @deprecated No-op. Update to the latest `request` RPC methods. */\n  decryptContent() {}\n\n  /**\n   * Sign the user out and optionally redirect to given location.\n   * @param redirectURL Location to redirect user to after sign out.\n   */\n  signUserOut(redirectURL?: string) {\n    this.store.deleteSessionData();\n    if (redirectURL && typeof location !== 'undefined' && location.href) {\n      location.href = redirectURL;\n    }\n  }\n}\n\n/** @deprecated Update to the latest `request` RPC methods. It's not recommended to use the UserSession. */\nexport interface UserData {\n  /** @deprecated */\n  email?: string;\n  /** @deprecated */\n  decentralizedID?: string;\n  /** @deprecated */\n  identityAddress?: string;\n  /** @deprecated */\n  appPrivateKey?: string;\n  /** @deprecated */\n  hubUrl?: string;\n  /** @deprecated */\n  coreNode?: string;\n  /** @deprecated */\n  authResponseToken?: string;\n  /** @deprecated */\n  coreSessionToken?: string;\n  /** @deprecated */\n  gaiaAssociationToken?: string;\n  /** @deprecated */\n  profile: any;\n  /** @deprecated */\n  gaiaHubConfig?: any;\n  /** @deprecated */\n  appPrivateKeyFromWalletSalt?: string;\n}\n\n/**\n * @abstract An abstract class representing the SessionDataStore interface.\n * @deprecated Update to the latest `request` RPC methods. It's not recommended to use the UserSession.\n */\nexport class SessionDataStore {\n  constructor(sessionOptions?: SessionOptions) {\n    if (sessionOptions) this.setSessionData(sessionOptions);\n  }\n\n  getSessionData(): SessionData {\n    throw new Error('Abstract class');\n  }\n\n  setSessionData(_session: SessionData): boolean {\n    throw new Error('Abstract class');\n  }\n\n  deleteSessionData(): boolean {\n    throw new Error('Abstract class');\n  }\n}\n\n/**\n * Stores session data in the instance of this class.\n *\n * @deprecated Update to the latest `request` RPC methods. It's not recommended to use the UserSession.\n */\nexport class InstanceDataStore extends SessionDataStore {\n  sessionData?: SessionData;\n\n  constructor(sessionOptions?: SessionOptions) {\n    super(sessionOptions);\n    if (!this.sessionData) this.setSessionData({});\n  }\n\n  getSessionData(): SessionData {\n    if (!this.sessionData) throw new NoSessionDataError('No session data was found.');\n    return this.sessionData;\n  }\n\n  setSessionData(session: SessionData): boolean {\n    this.sessionData = session;\n    return true;\n  }\n\n  deleteSessionData(): boolean {\n    this.setSessionData({});\n    return true;\n  }\n}\n\n/**\n * Stores session data in browser a localStorage entry.\n *\n * @deprecated Update to the latest `request` RPC methods. It's not recommended to use the UserSession.\n */\nexport class LocalStorageStore extends SessionDataStore {\n  key: string;\n\n  constructor(sessionOptions?: SessionOptions) {\n    super(sessionOptions);\n    this.key =\n      typeof sessionOptions?.storeOptions?.localStorageKey === 'string'\n        ? sessionOptions.storeOptions.localStorageKey\n        : LOCALSTORAGE_SESSION_KEY;\n\n    const data = localStorage.getItem(this.key);\n    if (!data) this.setSessionData({});\n  }\n\n  getSessionData(): SessionData {\n    const data = localStorage.getItem(this.key);\n    if (!data) throw new NoSessionDataError('No session data was found in localStorage');\n\n    return JSON.parse(data);\n  }\n\n  setSessionData(session: SessionData): boolean {\n    localStorage.setItem(this.key, JSON.stringify(session));\n    return true;\n  }\n\n  deleteSessionData(): boolean {\n    localStorage.removeItem(this.key);\n    this.setSessionData({});\n    return true;\n  }\n}\n\n/** @deprecated Update to the latest `request` RPC methods. It's not recommended to use the UserSession. */\nexport const getOrCreateUserSession = (userSession?: UserSession): UserSession => {\n  if (userSession) return userSession;\n  return new UserSession();\n};\n\n/** @deprecated Update to the latest `request` RPC methods. It's not recommended to use the UserSession. */\nexport const getUserData = async (userSession?: UserSession) => {\n  userSession = getOrCreateUserSession(userSession);\n  if (userSession.isUserSignedIn()) return Promise.resolve(userSession.loadUserData());\n  return Promise.resolve(null);\n};\n\n/** @internal */\nexport function isAddressTaproot(address: string) {\n  const PREFIXES = ['bc1p', 'tb1p', 'bcrt1p'];\n  const LENGTHS = [62, 62, 64];\n\n  const index = PREFIXES.findIndex(p => address.startsWith(p));\n  if (index === -1) return false;\n\n  return address.length === LENGTHS[index];\n}\n","import type { AuthOptions } from '../types/auth';\nimport {\n  ClarityValue as LegacyClarityValue,\n  PostCondition as LegacyPostCondition,\n  PostConditionMode as LegacyPostConditionMode,\n} from '@stacks/transactions-v6';\nimport {\n  PostConditionMode,\n  PostCondition,\n  AnchorMode,\n  ClarityValue,\n  StacksTransactionWire,\n} from '@stacks/transactions';\nimport { ConnectNetwork } from './network';\nimport { UserSession } from '../auth';\n\nexport interface TxBase {\n  appDetails?: AuthOptions['appDetails'];\n  postConditionMode?: LegacyPostConditionMode | PostConditionMode;\n  postConditions?: (string | LegacyPostCondition | PostCondition)[];\n  network?: ConnectNetwork;\n  anchorMode?: AnchorMode;\n  attachment?: string;\n  fee?: number | string;\n  /**\n   * Provide the Hiro Wallet with a suggested account to sign this transaction with.\n   * This is set by default if a `userSession` option is provided.\n   */\n  stxAddress?: string;\n  /** @deprecated `unused - only included for compatibility with @stacks/transactions` */\n  senderKey?: string;\n  /** @deprecated `unused - only included for compatibility with @stacks/transactions` */\n  nonce?: number;\n}\n\nexport interface SignTransactionBase {\n  appDetails?: AuthOptions['appDetails'];\n  network?: ConnectNetwork;\n  attachment?: string;\n  /**\n   * Provide wallets with a suggested account to sign this transaction with.\n   * This is set by default if a `userSession` option is provided.\n   */\n  stxAddress?: string;\n  txHex: string;\n  /** @deprecated `unused - only included for compatibility with other transaction types` */\n  postConditions?: (string | LegacyPostCondition | PostCondition)[];\n}\n\nexport interface SponsoredFinishedTxPayload {\n  txRaw: string;\n}\n\nexport interface SponsoredFinishedTxData extends SponsoredFinishedTxPayload {\n  stacksTransaction: StacksTransactionWire;\n}\n\nexport interface FinishedTxPayload extends SponsoredFinishedTxPayload {\n  txId: string;\n}\n\nexport interface FinishedTxData extends FinishedTxPayload {\n  stacksTransaction: StacksTransactionWire;\n}\n\nexport enum TransactionTypes {\n  ContractCall = 'contract_call',\n  ContractDeploy = 'smart_contract',\n  STXTransfer = 'token_transfer',\n}\n\n/**\n * Contract Call\n */\n\nexport enum ContractCallArgumentType {\n  BUFFER = 'buffer',\n  UINT = 'uint',\n  INT = 'int',\n  PRINCIPAL = 'principal',\n  BOOL = 'bool',\n}\n\nexport interface ContractCallBase extends TxBase {\n  contractAddress: string;\n  contractName: string;\n  functionName: string;\n  functionArgs: (string | LegacyClarityValue | ClarityValue)[];\n}\n\nexport interface OptionsBase {\n  /**\n   * @deprecated Authentication is no longer supported through a hosted\n   * version. Users must install an extension.\n   */\n  authOrigin?: string;\n  userSession?: UserSession;\n}\n\nexport type SponsoredFinished = (data: SponsoredFinishedTxData) => void;\nexport type Finished = (data: FinishedTxData) => void;\nexport type Canceled = (error?: Error) => void;\n\nexport interface SponsoredOptionsBase extends TxBase, OptionsBase {\n  sponsored: true;\n  onFinish?: SponsoredFinished;\n  onCancel?: Canceled;\n}\n\nexport interface RegularOptionsBase extends TxBase, OptionsBase {\n  sponsored?: false;\n  onFinish?: Finished;\n  onCancel?: Canceled;\n}\n\nexport type ContractCallRegularOptions = ContractCallBase & RegularOptionsBase;\nexport type ContractCallSponsoredOptions = ContractCallBase & SponsoredOptionsBase;\nexport type ContractCallOptions = ContractCallRegularOptions | ContractCallSponsoredOptions;\n\nexport interface ContractCallArgument {\n  type: ContractCallArgumentType;\n  value: string;\n}\n\nexport interface ContractCallPayload extends ContractCallBase {\n  txType: TransactionTypes.ContractCall;\n  publicKey: string;\n  functionArgs: string[];\n  sponsored?: boolean;\n}\n\n/**\n * Contract Deploy\n */\nexport interface ContractDeployBase extends TxBase {\n  contractName: string;\n  codeBody: string;\n  /**\n   * Optional integer value to specify the Clarity version to use for this contract.\n   * Current live Clarity versions are: `1`, `2`, and `3`.\n   *\n   * ⚠︎ Warning: Wallets may not support this parameter yet and typically default to the latest Clarity version.\n   */\n  clarityVersion?: number;\n}\n\nexport type ContractDeployRegularOptions = ContractDeployBase & RegularOptionsBase;\nexport type ContractDeploySponsoredOptions = ContractDeployBase & SponsoredOptionsBase;\nexport type ContractDeployOptions = ContractDeployRegularOptions | ContractDeploySponsoredOptions;\n\nexport interface ContractDeployPayload extends ContractDeployBase {\n  publicKey: string;\n  txType: TransactionTypes.ContractDeploy;\n  sponsored?: boolean;\n}\n\n/**\n * STX Transfer\n */\n\nexport interface STXTransferBase extends TxBase {\n  recipient: string;\n  amount: BigInt | string;\n  memo?: string;\n}\n\nexport type STXTransferRegularOptions = STXTransferBase & RegularOptionsBase;\nexport type STXTransferSponsoredOptions = STXTransferBase & SponsoredOptionsBase;\nexport type STXTransferOptions = STXTransferRegularOptions | STXTransferSponsoredOptions;\n\nexport interface STXTransferPayload extends STXTransferBase {\n  publicKey: string;\n  txType: TransactionTypes.STXTransfer;\n  amount: string;\n  sponsored?: boolean;\n}\n\n/**\n * Transaction Popup\n */\n\nexport type TransactionOptions =\n  | ContractCallOptions\n  | ContractDeployOptions\n  | STXTransferOptions\n  | SignTransactionOptions;\nexport type TransactionPayload =\n  | ContractCallPayload\n  | ContractDeployPayload\n  | STXTransferPayload\n  | SignTransactionPayload;\n\nexport interface TransactionPopup {\n  token: string;\n  options: TransactionOptions;\n}\n\nexport interface SignTransactionOptionBase extends SignTransactionBase, OptionsBase {\n  onFinish?: SignTransactionFinished;\n  onCancel?: Canceled;\n}\n\nexport interface SignTransactionPayload extends SignTransactionBase {\n  publicKey: string;\n}\n\nexport type SignTransactionFinished = (data: SignTransactionFinishedTxData) => void;\n\nexport type SignTransactionOptions = SignTransactionOptionBase;\n\nexport interface SignTransactionFinishedTxData {\n  stacksTransaction: StacksTransactionWire;\n}\n","import { UserSession } from '../auth';\nimport { AuthOptions } from './auth';\nimport { ConnectNetwork } from './network';\n\n// Taken from @scure/btc-signer\n// https://github.com/paulmillr/scure-btc-signer\nexport enum SignatureHash {\n  DEFAULT = 0,\n  ALL = 1,\n  NONE = 2,\n  SINGLE = 3,\n  ANYONECANPAY = 0x80,\n}\n\nexport interface PsbtData {\n  hex: string;\n}\n\nexport type PsbtCanceled = (error?: Error) => void;\nexport type PsbtFinished = (data: PsbtData) => void;\n\nexport interface PsbtBase {\n  appDetails?: AuthOptions['appDetails'];\n  authOrigin?: string;\n  network?: ConnectNetwork;\n  onCancel?: PsbtCanceled;\n  onFinish?: PsbtFinished;\n  stxAddress?: string;\n  userSession?: UserSession;\n}\n\nexport interface PsbtRequestOptions extends PsbtBase {\n  allowedSighash?: SignatureHash[];\n  hex: string;\n  signAtIndex?: number | number[];\n}\n\nexport interface CommonPsbtPayload extends PsbtBase {\n  publicKey: string;\n}\n\nexport interface PsbtPayload extends CommonPsbtPayload {\n  allowedSighash?: SignatureHash[];\n  hex: string;\n  signAtIndex?: number | number[];\n}\n\n/**\n * Psbt Popup\n */\nexport interface PsbtPopup {\n  token: string;\n  options: PsbtRequestOptions;\n}\n","import { getProviderFromId, getSelectedProviderId } from '@stacks/connect-ui';\nimport { TransactionVersion } from '@stacks/network';\nimport {\n  StacksDevnet as LegacyStacksDevnet,\n  StacksMainnet as LegacyStacksMainnet,\n  StacksMocknet as LegacyStacksMocknet,\n  StacksNetwork as LegacyStacksNetwork,\n  StacksTestnet as LegacyStacksTestnet,\n} from '@stacks/network-v6';\nimport { Address, Cl, ClarityValue } from '@stacks/transactions';\nimport {\n  ClarityType as LegacyClarityType,\n  ClarityValue as LegacyClarityValue,\n} from '@stacks/transactions-v6';\nimport { ConnectNetwork } from './types';\n\n/** @deprecated This will default to the legacy provider. The behavior may be undefined with competing wallets. */\nexport function getStacksProvider() {\n  const provider = getProviderFromId(getSelectedProviderId());\n  return provider || (window as any).StacksProvider || (window as any).BlockstackProvider;\n}\n\nexport function isStacksWalletInstalled() {\n  return !!getStacksProvider();\n}\n\n/** @internal */\nexport function legacyNetworkFromConnectNetwork(network?: ConnectNetwork): LegacyStacksNetwork {\n  if (!network) return new LegacyStacksTestnet();\n  if (typeof network === 'string') return LegacyStacksNetwork.fromName(network);\n  if ('version' in network) return network; // legacy type\n\n  if ('url' in network) return new LegacyStacksMainnet({ url: network.url }); // experimental\n\n  return network.transactionVersion === (TransactionVersion.Mainnet as number)\n    ? new LegacyStacksMainnet({ url: network.client.baseUrl })\n    : new LegacyStacksTestnet({ url: network.client.baseUrl });\n}\n\nfunction isInstance<T>(object: any, clazz: { new (...args: any[]): T }): object is T {\n  return object instanceof clazz || object?.constructor?.name?.toLowerCase() === clazz.name;\n}\n\n/** @internal */\nexport function connectNetworkToString(network: ConnectNetwork): string {\n  // not perfect, but good enough to identify the legacy network in most cases\n  if (!network) return 'mainnet';\n  if (typeof network === 'string') return network;\n  if (isInstance(network, LegacyStacksMainnet)) return 'mainnet';\n  if (isInstance(network, LegacyStacksTestnet)) return 'testnet';\n  if (isInstance(network, LegacyStacksDevnet)) return 'devnet';\n  if (isInstance(network, LegacyStacksMocknet)) return 'devnet';\n\n  if ('coreApiUrl' in (network as any)) return (network as any).coreApiUrl; // in case alternate network was used\n  if ('url' in network) return network.url;\n  if ('transactionVersion' in network) {\n    return network.transactionVersion === (TransactionVersion.Mainnet as number)\n      ? 'mainnet'\n      : 'testnet';\n  }\n  return 'mainnet';\n}\n\n/**\n * @internal\n * This may be moved to Stacks.js in the future.\n */\nexport function legacyCVToCV(cv: LegacyClarityValue | ClarityValue): ClarityValue {\n  if (typeof cv.type === 'string') return cv;\n\n  switch (cv.type) {\n    case LegacyClarityType.BoolFalse:\n      return Cl.bool(false);\n    case LegacyClarityType.BoolTrue:\n      return Cl.bool(true);\n    case LegacyClarityType.Int:\n      return Cl.int(cv.value);\n    case LegacyClarityType.UInt:\n      return Cl.uint(cv.value);\n    case LegacyClarityType.Buffer:\n      return Cl.buffer(cv.buffer);\n    case LegacyClarityType.StringASCII:\n      return Cl.stringAscii(cv.data);\n    case LegacyClarityType.StringUTF8:\n      return Cl.stringUtf8(cv.data);\n    case LegacyClarityType.List:\n      return Cl.list(cv.list.map(legacyCVToCV));\n    case LegacyClarityType.Tuple:\n      return Cl.tuple(\n        Object.fromEntries(Object.entries(cv.data).map(([k, v]) => [k, legacyCVToCV(v)]))\n      );\n    case LegacyClarityType.OptionalNone:\n      return Cl.none();\n    case LegacyClarityType.OptionalSome:\n      return Cl.some(legacyCVToCV(cv.value));\n    case LegacyClarityType.ResponseErr:\n      return Cl.error(legacyCVToCV(cv.value));\n    case LegacyClarityType.ResponseOk:\n      return Cl.ok(legacyCVToCV(cv.value));\n    case LegacyClarityType.PrincipalContract:\n      return Cl.contractPrincipal(Address.stringify(cv.address), cv.contractName.content);\n    case LegacyClarityType.PrincipalStandard:\n      return Cl.standardPrincipal(Address.stringify(cv.address));\n    default:\n      const _exhaustiveCheck: never = cv;\n      throw new Error(`Unknown clarity type: ${_exhaustiveCheck}`);\n  }\n}\n\n/** @internal */\nexport function removeUnserializableKeys<O>(\n  obj: O | { onFinish?: Function; onCancel?: Function }\n): O {\n  return {\n    ...obj,\n    onFinish: undefined,\n    onCancel: undefined,\n  } as O;\n}\n","import { PublicPersonProfile } from '@stacks/profile';\nimport { MethodParams, MethodResult } from '../methods';\nimport { requestRawLegacy } from '../request';\nimport { ProfileUpdateRequestOptions, StacksProvider } from '../types';\nimport { getStacksProvider } from '../utils';\n\n/** @deprecated No-op. Tokens are not needed for latest RPC endpoints. */\nexport function getDefaultProfileUpdateRequestOptions(_options: ProfileUpdateRequestOptions) {}\n\n/** @deprecated No-op. Tokens are not needed for latest RPC endpoints. */\nexport const makeProfileUpdateToken = async (_options: ProfileUpdateRequestOptions) => {};\n\nconst METHOD = 'stx_updateProfile' as const;\n\n/** @internal */\nexport const LEGACY_UPDATE_PROFILE_OPTIONS_MAP = (\n  options: ProfileUpdateRequestOptions\n): MethodParams<typeof METHOD> => options;\n\n/** @internal */\nexport const LEGACY_UPDATE_PROFILE_RESPONSE_MAP = (\n  response: MethodResult<typeof METHOD>\n): PublicPersonProfile => response.profile as PublicPersonProfile;\n\n/** Compatible interface with previous Connect `openProfileUpdateRequestPopup` version, but using new SIP-030 RPC method. */\nexport function openProfileUpdateRequestPopup(\n  options: ProfileUpdateRequestOptions,\n  provider: StacksProvider = getStacksProvider()\n) {\n  requestRawLegacy(\n    METHOD,\n    LEGACY_UPDATE_PROFILE_OPTIONS_MAP,\n    LEGACY_UPDATE_PROFILE_RESPONSE_MAP\n  )(options, provider);\n}\n","import { MethodParams, MethodResult } from '../methods';\nimport { requestRawLegacy } from '../request';\nimport { StacksProvider } from '../types';\nimport {\n  CommonSignatureRequestOptions,\n  SignatureData,\n  SignatureRequestOptions,\n} from '../types/signature';\nimport { getStacksProvider } from '../utils';\n\n/** @deprecated No-op. Tokens are not needed for latest RPC endpoints. */\nexport function getDefaultSignatureRequestOptions(_options: CommonSignatureRequestOptions) {}\n\nexport interface SignatureRequestPayload {\n  message: string;\n}\n\n/** @deprecated No-op. Tokens are not needed for latest RPC endpoints. */\nexport const signMessage = async (_options: SignatureRequestOptions) => {};\n\nconst METHOD = 'stx_signMessage' as const;\n\n/** @internal */\nexport const LEGACY_SIGN_MESSAGE_OPTIONS_MAP = (\n  options: SignatureRequestOptions\n): MethodParams<typeof METHOD> => options;\n\n/** @internal */\nexport const LEGACY_SIGN_MESSAGE_RESPONSE_MAP = (\n  response: MethodResult<typeof METHOD>\n): SignatureData => response;\n\n/** Compatible interface with previous Connect `openSignatureRequestPopup` version, but using new SIP-030 RPC method. */\nexport function openSignatureRequestPopup(\n  options: SignatureRequestOptions,\n  provider: StacksProvider = getStacksProvider()\n) {\n  requestRawLegacy(\n    METHOD,\n    LEGACY_SIGN_MESSAGE_OPTIONS_MAP,\n    LEGACY_SIGN_MESSAGE_RESPONSE_MAP\n  )(options, provider);\n}\n","import { TupleCV } from '@stacks/transactions';\nimport { ClarityType as LegacyClarityType } from '@stacks/transactions-v6';\nimport { MethodParams, MethodResult } from '../methods';\nimport { requestRawLegacy } from '../request';\nimport { SignatureData, StacksProvider } from '../types';\nimport { StructuredDataSignatureRequestOptions } from '../types/structuredDataSignature';\nimport { getStacksProvider, legacyCVToCV } from '../utils';\n\n/** @deprecated No-op. Tokens are not needed for latest RPC endpoints. */\nexport async function signStructuredMessage(_options: StructuredDataSignatureRequestOptions) {}\n\nconst METHOD = 'stx_signStructuredMessage' as const;\n\n/** @internal */\nexport const LEGACY_SIGN_STRUCTURED_MESSAGE_OPTIONS_MAP = (\n  options: StructuredDataSignatureRequestOptions\n): MethodParams<typeof METHOD> => ({\n  // todo: also make sure that cvs don't have bigint unserializable values\n  message: legacyCVToCV(options.message),\n  domain: legacyCVToCV(options.domain) as TupleCV, // safe cast, because of below check\n});\n\n/** @internal */\nexport const LEGACY_SIGN_STRUCTURED_MESSAGE_RESPONSE_MAP = (\n  response: MethodResult<typeof METHOD>\n): SignatureData => response;\n\n/** Compatible interface with previous Connect `openStructuredDataSignatureRequestPopup` version, but using new SIP-030 RPC method. */\nexport function openStructuredDataSignatureRequestPopup(\n  options: StructuredDataSignatureRequestOptions,\n  provider: StacksProvider = getStacksProvider()\n): void {\n  if (options.domain.type !== LegacyClarityType.Tuple) {\n    throw new Error('Domain must be a tuple'); // check, ensures domain is a tuple\n  }\n\n  requestRawLegacy(\n    METHOD,\n    LEGACY_SIGN_STRUCTURED_MESSAGE_OPTIONS_MAP,\n    LEGACY_SIGN_STRUCTURED_MESSAGE_RESPONSE_MAP\n  )(options, provider);\n}\n","import { bytesToHex } from '@stacks/common';\nimport { ChainId } from '@stacks/network';\nimport {\n  Cl,\n  deserializeTransaction,\n  PostCondition,\n  PostConditionMode,\n  PostConditionModeName,\n} from '@stacks/transactions';\nimport {\n  PostCondition as LegacyPostCondition,\n  serializePostCondition as legacySerializePostCondition,\n} from '@stacks/transactions-v6';\nimport { MethodParams, MethodResult } from '../methods';\nimport { requestRawLegacy } from '../request';\nimport { StacksProvider } from '../types';\nimport {\n  ContractCallOptions,\n  ContractCallRegularOptions,\n  ContractCallSponsoredOptions,\n  ContractDeployOptions,\n  FinishedTxData,\n  SignTransactionFinishedTxData,\n  SignTransactionOptions,\n  SponsoredFinishedTxData,\n  STXTransferOptions,\n  STXTransferRegularOptions,\n  STXTransferSponsoredOptions,\n  TransactionOptions,\n} from '../types/transactions';\nimport {\n  connectNetworkToString,\n  getStacksProvider,\n  legacyCVToCV,\n  legacyNetworkFromConnectNetwork,\n} from '../utils';\nimport { AppConfig, UserSession } from '../auth';\n\n/** @deprecated Update to the latest `request` RPC methods. It's not recommended to use the UserSession. */\nexport const getUserSession = (_userSession?: UserSession) => {\n  let userSession = _userSession;\n\n  if (!userSession) {\n    const appConfig = new AppConfig(['store_write'], document.location.href);\n    userSession = new UserSession({ appConfig });\n  }\n  return userSession;\n};\n\n/** @deprecated Update to the latest `request` RPC methods. It's not recommended to use the UserSession. */\nexport function hasAppPrivateKey(userSession?: UserSession) {\n  try {\n    const session = getUserSession(userSession).loadUserData();\n    return session.appPrivateKey;\n  } catch (e) {\n    return false;\n  }\n}\n\n/** @deprecated No-op. Update to the latest `request` RPC methods. */\nexport const getKeys = (_userSession?: UserSession) => {};\n\n/** @deprecated Update to the latest `request` RPC methods. It's not recommended to use the UserSession. */\nexport function getStxAddress(options: TransactionOptions) {\n  const { stxAddress, userSession, network: _network } = options;\n\n  if (stxAddress) return stxAddress;\n  if (!userSession || !_network) return undefined;\n  const stxAddresses = userSession?.loadUserData().profile?.stxAddress;\n\n  const chainIdToKey = {\n    [ChainId.Mainnet]: 'mainnet',\n    [ChainId.Testnet]: 'testnet',\n  };\n  const network = legacyNetworkFromConnectNetwork(_network);\n  const address: string | undefined = stxAddresses?.[chainIdToKey[network.chainId]];\n  return address;\n}\n\n/** @deprecated No-op. Tokens are not needed for latest RPC endpoints. */\nexport const makeContractCallToken = async (_options: ContractCallOptions) => {};\n\n/** @deprecated No-op. Tokens are not needed for latest RPC endpoints. */\nexport const makeContractDeployToken = async (_options: ContractDeployOptions) => {};\n\n/** @deprecated No-op. Tokens are not needed for latest RPC endpoints. */\nexport const makeSTXTransferToken = async (_options: STXTransferOptions) => {};\n\n/** @deprecated No-op. Tokens are not needed for latest RPC endpoints. */\nexport const makeSignTransaction = async (_options: SignTransactionOptions) => {};\n\n// # TRANSACTION METHODS\n\n// ## Contract Call\n\nconst METHOD_CALL_CONTRACT = 'stx_callContract' as const;\n\n/** @internal */\nexport const LEGACY_CALL_CONTRACT_OPTIONS_MAP = (\n  options: ContractCallOptions\n): MethodParams<typeof METHOD_CALL_CONTRACT> => {\n  const functionArgs = options.functionArgs\n    ?.map(arg => {\n      if (typeof arg === 'string') return Cl.deserialize(arg);\n      return legacyCVToCV(arg);\n    })\n    // serialize to hex, since some wallets expect hex-encoded args\n    .map(arg => Cl.serialize(arg));\n\n  return {\n    ...options,\n    contract: `${options.contractAddress}.${options.contractName}`,\n    functionArgs,\n    network: connectNetworkToString(options.network),\n    postConditionMode: optPostConditionMode(options.postConditionMode),\n    postConditions: optPostCondition(options.postConditions),\n    address: options.stxAddress,\n  };\n};\n\n/** @internal */\nexport const LEGACY_CALL_CONTRACT_RESPONSE_MAP = (\n  response: MethodResult<typeof METHOD_CALL_CONTRACT>\n): FinishedTxData | SponsoredFinishedTxData => ({\n  txId: response.txid,\n  txRaw: response.transaction,\n  stacksTransaction: deserializeTransaction(response.transaction),\n});\n\n/** Compatible interface with previous Connect `openContractCall` version, but using new SIP-030 RPC method. */\nexport function openContractCall(\n  options: ContractCallOptions | ContractCallRegularOptions | ContractCallSponsoredOptions,\n  provider: StacksProvider = getStacksProvider()\n) {\n  requestRawLegacy(\n    METHOD_CALL_CONTRACT,\n    LEGACY_CALL_CONTRACT_OPTIONS_MAP,\n    LEGACY_CALL_CONTRACT_RESPONSE_MAP\n  )(options, provider);\n}\n\n// ## Contract Deploy\n\nconst METHOD_DEPLOY_CONTRACT = 'stx_deployContract' as const;\n\n/** @internal */\nexport const LEGACY_DEPLOY_CONTRACT_OPTIONS_MAP = (\n  options: ContractDeployOptions\n): MethodParams<typeof METHOD_DEPLOY_CONTRACT> => ({\n  ...options,\n  name: options.contractName,\n  clarityCode: options.codeBody,\n  network: connectNetworkToString(options.network),\n  postConditionMode: optPostConditionMode(options.postConditionMode),\n  postConditions: optPostCondition(options.postConditions),\n  address: options.stxAddress,\n});\n\n/** @internal */\nexport const LEGACY_DEPLOY_CONTRACT_RESPONSE_MAP = (\n  response: MethodResult<typeof METHOD_DEPLOY_CONTRACT>\n): FinishedTxData | SponsoredFinishedTxData => ({\n  txId: response.txid,\n  txRaw: response.transaction,\n  stacksTransaction: deserializeTransaction(response.transaction),\n});\n\n/** Compatible interface with previous Connect `openContractDeploy` version, but using new SIP-030 RPC method. */\nexport function openContractDeploy(\n  options: ContractDeployOptions,\n  provider: StacksProvider = getStacksProvider()\n) {\n  requestRawLegacy(\n    METHOD_DEPLOY_CONTRACT,\n    LEGACY_DEPLOY_CONTRACT_OPTIONS_MAP,\n    LEGACY_DEPLOY_CONTRACT_RESPONSE_MAP\n  )(options, provider);\n}\n\n// ## STX Transfer\n\nconst METHOD_TRANSFER_STX = 'stx_transferStx' as const;\n\n/** @internal */\nexport const LEGACY_TRANSFER_STX_OPTIONS_MAP = (\n  options: STXTransferOptions\n): MethodParams<typeof METHOD_TRANSFER_STX> => ({\n  ...options,\n  amount: options.amount.toString(),\n  network: connectNetworkToString(options.network),\n  address: options.stxAddress,\n});\n\n/** @internal */\nexport const LEGACY_TRANSFER_STX_RESPONSE_MAP = (\n  response: MethodResult<typeof METHOD_TRANSFER_STX>\n): FinishedTxData | SponsoredFinishedTxData => ({\n  txId: response.txid,\n  txRaw: response.transaction,\n  stacksTransaction: deserializeTransaction(response.transaction),\n});\n\n/** Compatible interface with previous Connect `openSTXTransfer` version, but using new SIP-030 RPC method. */\nexport function openSTXTransfer(\n  options: STXTransferOptions | STXTransferRegularOptions | STXTransferSponsoredOptions,\n  provider: StacksProvider = getStacksProvider()\n) {\n  requestRawLegacy(\n    METHOD_TRANSFER_STX,\n    LEGACY_TRANSFER_STX_OPTIONS_MAP,\n    LEGACY_TRANSFER_STX_RESPONSE_MAP\n  )(options, provider);\n}\n\n// ## Sign Transaction\n\nconst METHOD_SIGN_TRANSACTION = 'stx_signTransaction' as const;\n\n/** @internal */\nexport const LEGACY_SIGN_TRANSACTION_OPTIONS_MAP = (\n  options: SignTransactionOptions\n): MethodParams<typeof METHOD_SIGN_TRANSACTION> => ({\n  ...options,\n  transaction: options.txHex,\n});\n\n/** @internal */\nexport const LEGACY_SIGN_TRANSACTION_RESPONSE_MAP = (\n  response: MethodResult<typeof METHOD_SIGN_TRANSACTION>\n): SignTransactionFinishedTxData => ({\n  ...response, // additional fields, in case previous type was incorrect\n  stacksTransaction: deserializeTransaction(response.transaction),\n});\n\n/** Compatible interface with previous Connect `openSignTransaction` version, but using new SIP-030 RPC method. */\nexport function openSignTransaction(\n  options: SignTransactionOptions,\n  provider: StacksProvider = getStacksProvider()\n) {\n  requestRawLegacy(\n    METHOD_SIGN_TRANSACTION,\n    LEGACY_SIGN_TRANSACTION_OPTIONS_MAP,\n    LEGACY_SIGN_TRANSACTION_RESPONSE_MAP\n  )(options, provider);\n}\n\n// ## Helpers\n\n/** @internal */\nfunction optPostCondition(pcs?: (string | LegacyPostCondition | PostCondition)[]) {\n  if (typeof pcs === 'undefined') return undefined;\n  return pcs.map(pc => {\n    if (typeof pc === 'string') return pc;\n    if (typeof pc.type === 'string') {\n      return {\n        ...pc,\n        amount: 'amount' in pc ? pc.amount.toString() : undefined, // ensure amount is not bigint\n      };\n    }\n    return bytesToHex(legacySerializePostCondition(pc));\n  });\n}\n\n/** @internal */\nfunction optPostConditionMode(mode?: PostConditionModeName | PostConditionMode) {\n  if (typeof mode === 'undefined') return undefined;\n  if (typeof mode === 'string') return mode;\n  switch (mode) {\n    case PostConditionMode.Allow:\n      return 'allow';\n    case PostConditionMode.Deny:\n      return 'deny';\n    default:\n      const _exhaustiveCheck: never = mode;\n      throw new Error(\n        `Unknown post condition mode: ${_exhaustiveCheck}. Should be one of: 'allow', 'deny'`\n      );\n  }\n}\n","import { authenticate } from './auth';\nimport { MethodParams, MethodResult, Methods } from './methods';\nimport { LEGACY_UPDATE_PROFILE_OPTIONS_MAP, LEGACY_UPDATE_PROFILE_RESPONSE_MAP } from './profile';\nimport { request } from './request';\nimport { LEGACY_SIGN_MESSAGE_OPTIONS_MAP, LEGACY_SIGN_MESSAGE_RESPONSE_MAP } from './signature';\nimport {\n  LEGACY_SIGN_STRUCTURED_MESSAGE_OPTIONS_MAP,\n  LEGACY_SIGN_STRUCTURED_MESSAGE_RESPONSE_MAP,\n} from './signature/structuredData';\nimport {\n  LEGACY_CALL_CONTRACT_OPTIONS_MAP,\n  LEGACY_CALL_CONTRACT_RESPONSE_MAP,\n  LEGACY_DEPLOY_CONTRACT_OPTIONS_MAP,\n  LEGACY_DEPLOY_CONTRACT_RESPONSE_MAP,\n  LEGACY_SIGN_TRANSACTION_OPTIONS_MAP,\n  LEGACY_SIGN_TRANSACTION_RESPONSE_MAP,\n  LEGACY_TRANSFER_STX_OPTIONS_MAP,\n  LEGACY_TRANSFER_STX_RESPONSE_MAP,\n} from './transactions';\nimport { StacksProvider } from './types';\nimport { removeUnserializableKeys } from './utils';\n\n/**\n * **Note:** Higher order function!\n * @internal Legacy UI request.\n */\nfunction requestLegacy<M extends keyof Methods, O, R>(\n  method: M,\n  mapOptions: (options: O) => MethodParams<M>,\n  mapResponse: (response: MethodResult<M>) => R\n) {\n  return (options: O, provider?: StacksProvider) => {\n    const params = mapOptions(removeUnserializableKeys(options));\n\n    // Manual cast, since TypeScipt can't infer generic type of options\n    const o = options as {\n      onCancel?: (error?: Error) => void;\n      onFinish?: (response: R) => void;\n    };\n\n    void request({ provider }, method, params)\n      .then(response => {\n        const r = mapResponse(response);\n        o.onFinish?.(r);\n      })\n      .catch(e => {\n        console.error(e); // todo: remove again? or maybe keep for legacy debugging\n        o.onCancel?.(e);\n      });\n  };\n}\n\n// BACKWARDS COMPATIBILITY\n\n/** A wrapper for selecting a wallet (if none is selected) and then calling the {@link authenticate} action. */\nexport const showConnect = authenticate;\n\n/** A wrapper for selecting a wallet (if none is selected) and then calling the {@link openSTXTransfer} action. */\nexport const showSTXTransfer = requestLegacy(\n  'stx_transferStx',\n  LEGACY_TRANSFER_STX_OPTIONS_MAP,\n  LEGACY_TRANSFER_STX_RESPONSE_MAP\n);\n\n/** A wrapper for selecting a wallet (if none is selected) and then calling the {@link openContractCall} action. */\nexport const showContractCall = requestLegacy(\n  'stx_callContract',\n  LEGACY_CALL_CONTRACT_OPTIONS_MAP,\n  LEGACY_CALL_CONTRACT_RESPONSE_MAP\n);\n\n/** A wrapper for selecting a wallet (if none is selected) and then calling the {@link openContractDeploy} action. */\nexport const showContractDeploy = requestLegacy(\n  'stx_deployContract',\n  LEGACY_DEPLOY_CONTRACT_OPTIONS_MAP,\n  LEGACY_DEPLOY_CONTRACT_RESPONSE_MAP\n);\n\n/** A wrapper for selecting a wallet (if none is selected) and then calling the {@link openSignTransaction} action. */\nexport const showSignTransaction = requestLegacy(\n  'stx_signTransaction',\n  LEGACY_SIGN_TRANSACTION_OPTIONS_MAP,\n  LEGACY_SIGN_TRANSACTION_RESPONSE_MAP\n);\n\n/** A wrapper for selecting a wallet (if none is selected) and then calling the {@link openProfileUpdateRequestPopup} action. */\nexport const showProfileUpdate = requestLegacy(\n  'stx_updateProfile',\n  LEGACY_UPDATE_PROFILE_OPTIONS_MAP,\n  LEGACY_UPDATE_PROFILE_RESPONSE_MAP\n);\n\n/** A wrapper for selecting a wallet (if none is selected) and then calling the {@link openSignatureRequestPopup} action. */\nexport const showSignMessage = requestLegacy(\n  'stx_signMessage',\n  LEGACY_SIGN_MESSAGE_OPTIONS_MAP,\n  LEGACY_SIGN_MESSAGE_RESPONSE_MAP\n);\n\n/** A wrapper for selecting a wallet (if none is selected) and then calling the {@link openStructuredDataSignatureRequestPopup} action. */\nexport const showSignStructuredMessage = requestLegacy(\n  'stx_signStructuredMessage',\n  LEGACY_SIGN_STRUCTURED_MESSAGE_OPTIONS_MAP,\n  LEGACY_SIGN_STRUCTURED_MESSAGE_RESPONSE_MAP\n);\n\nexport { getProvider as getSelectedProvider, isProviderSelected } from '@stacks/connect-ui';\n\n/**\n * @deprecated Use the renamed {@link showConnect} method\n */\nexport const showBlockstackConnect = showConnect;\n","import { base64 } from '@scure/base';\nimport { bytesToHex, hexToBytes } from '@stacks/common';\nimport { MethodParams, MethodResult, Sighash } from '../methods';\nimport { requestRawLegacy } from '../request';\nimport { StacksProvider } from '../types';\nimport { PsbtData, PsbtRequestOptions, SignatureHash } from '../types/bitcoin';\nimport { getStacksProvider } from '../utils';\n\n/** @deprecated No-op. Tokens are not needed for latest RPC endpoints. */\nexport function getDefaultPsbtRequestOptions(_options: PsbtRequestOptions) {}\n\n/** @deprecated No-op. Tokens are not needed for latest RPC endpoints. */\nexport const makePsbtToken = async (_options: PsbtRequestOptions) => {};\n\nconst METHOD = 'signPsbt' as const;\n\n/** @internal */\nexport const LEGACY_SIGN_PSBT_OPTIONS_MAP = (\n  options: PsbtRequestOptions\n): MethodParams<typeof METHOD> => ({\n  psbt: base64.encode(hexToBytes(options.hex)),\n  signInputs: typeof options.signAtIndex === 'number' ? [options.signAtIndex] : options.signAtIndex,\n  allowedSighash: options.allowedSighash?.map(hash => SignatureHash[hash] as Sighash),\n});\n\n/** @internal */\nexport const LEGACY_SIGN_PSBT_RESPONSE_MAP = (response: MethodResult<typeof METHOD>): PsbtData => ({\n  hex: bytesToHex(base64.decode(response.psbt)),\n});\n\n/**\n * @experimental\n * Compatible interface with previous Connect `openPsbtRequestPopup` version, but using new SIP-030 RPC method.\n */\nexport function openPsbtRequestPopup(\n  options: PsbtRequestOptions,\n  provider: StacksProvider = getStacksProvider()\n) {\n  requestRawLegacy(\n    METHOD,\n    LEGACY_SIGN_PSBT_OPTIONS_MAP,\n    LEGACY_SIGN_PSBT_RESPONSE_MAP\n  )(options, provider);\n}\n"]}