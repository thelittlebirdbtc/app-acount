import {bytesToUtf8,hexToBytes,bytesToHex,NoSessionDataError,utf8ToBytes}from'@stacks/common';import {base64}from'@scure/base';import {clearSelectedProviderId,getProvider,getInstalledProviders,getProviderFromId,setSelectedProviderId,getSelectedProviderId}from'@stacks/connect-ui';export{clearSelectedProviderId,getProvider as getSelectedProvider,getSelectedProviderId,isProviderSelected,setSelectedProviderId}from'@stacks/connect-ui';import {defineCustomElements}from'@stacks/connect-ui/loader';import {postConditionToHex,Cl,deserializeTransaction,PostConditionMode,Address}from'@stacks/transactions';import {ChainId,TransactionVersion}from'@stacks/network';import {StacksNetwork,StacksMainnet,StacksTestnet,StacksDevnet,StacksMocknet}from'@stacks/network-v6';import {ClarityType,serializePostCondition}from'@stacks/transactions-v6';var Fe=Object.defineProperty,Be=Object.defineProperties;var We=Object.getOwnPropertyDescriptors;var w=Object.getOwnPropertySymbols;var pe=Object.prototype.hasOwnProperty,le=Object.prototype.propertyIsEnumerable;var Me=(e,t,o)=>t in e?Fe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,u=(e,t)=>{for(var o in t||(t={}))pe.call(t,o)&&Me(e,o,t[o]);if(w)for(var o of w(t))le.call(t,o)&&Me(e,o,t[o]);return e},M=(e,t)=>Be(e,We(t));var ge=(e,t)=>{var o={};for(var s in e)pe.call(e,s)&&t.indexOf(s)<0&&(o[s]=e[s]);if(e!=null&&w)for(var s of w(e))t.indexOf(s)<0&&le.call(e,s)&&(o[s]=e[s]);return o};var I=class e extends Error{constructor(o,s,n,r){super(o);this.message=o;this.code=s;this.data=n;this.cause=r;this.name="JsonRpcError",this.message=o,this.code=s,this.data=n,this.cause=r;}static fromResponse(o){return new e(o.message,o.code,o.data)}toString(){return `${this.name} (${this.code}): ${this.message}${this.data?`: ${JSON.stringify(this.data)}`:""}`}},Se=(a=>(a[a.ParseError=-32700]="ParseError",a[a.InvalidRequest=-32600]="InvalidRequest",a[a.MethodNotFound=-32601]="MethodNotFound",a[a.InvalidParams=-32602]="InvalidParams",a[a.InternalError=-32603]="InternalError",a[a.UserRejection=-32e3]="UserRejection",a[a.MethodAddressMismatch=-32001]="MethodAddressMismatch",a[a.MethodAccessDenied=-32002]="MethodAccessDenied",a[a.UnknownError=-31e3]="UnknownError",a[a.UserCanceled=-31001]="UserCanceled",a))(Se||{});var Ae="asigna-stx",fe=(e,t)=>new Promise(o=>{function s(n){n.data.source===Ae&&n.data[t]&&(o(n.data[t]),window.removeEventListener("message",s));}window.addEventListener("message",s),window.top.postMessage(Ze(e,t),"*");}),qe={authenticationRequest:async e=>fe(e,"authenticationRequest"),transactionRequest:async e=>fe(e,"transactionRequest")},Ze=(e,t)=>({source:Ae,[t]:e}),ye=()=>{if(typeof window=="undefined")return;!!window.top&&document.referrer.endsWith(".asigna.io/")&&(window.AsignaProvider=qe);};ye();var De=[{id:"LeatherProvider",name:"Leather",icon:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTI4IiBoZWlnaHQ9IjEyOCIgdmlld0JveD0iMCAwIDEyOCAxMjgiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMjgiIGhlaWdodD0iMTI4IiByeD0iMjYuODM4NyIgZmlsbD0iIzEyMTAwRiIvPgo8cGF0aCBkPSJNNzQuOTE3MSA1Mi43MTE0QzgyLjQ3NjYgNTEuNTQwOCA5My40MDg3IDQzLjU4MDQgOTMuNDA4NyAzNy4zNzYxQzkzLjQwODcgMzUuNTAzMSA5MS44OTY4IDM0LjIxNTQgODkuNjg3MSAzNC4yMTU0Qzg1LjUwMDQgMzQuMjE1NCA3OC40MDYxIDQwLjUzNjggNzQuOTE3MSA1Mi43MTE0Wk0zOS45MTEgODMuNDk5MUMzMC4wMjU2IDgzLjQ5OTEgMjkuMjExNSA5My4zMzI0IDM5LjA5NjkgOTMuMzMyNEM0My41MTYzIDkzLjMzMjQgNDguODY2MSA5MS41NzY0IDUxLjY1NzMgODguNDE1N0M0Ny41ODY4IDg0LjkwMzggNDQuMjE0MSA4My40OTkxIDM5LjkxMSA4My40OTkxWk0xMDIuODI5IDc5LjI4NDhDMTAzLjQxIDk1Ljc5MDcgOTUuMDM2OSAxMDUuMDM5IDgwLjg0ODQgMTA1LjAzOUM3Mi40NzQ4IDEwNS4wMzkgNjguMjg4MSAxMDEuODc4IDU5LjMzMyA5Ni4wMjQ5QzU0LjY4MSAxMDEuMTc2IDQ1Ljg0MjMgMTA1LjAzOSAzOC41MTU0IDEwNS4wMzlDMTMuMjc4NSAxMDUuMDM5IDE0LjMyNTIgNzIuODQ2MyA0MC4wMjczIDcyLjg0NjNDNDUuMzc3MSA3Mi44NDYzIDQ5LjkxMjggNzQuMjUxMSA1NS43Mjc3IDc3Ljg4TDU5LjU2NTYgNjQuNDE3N0M0My43NDg5IDYwLjA4NjQgMzUuODQwNSA0Ny45MTE4IDQzLjYzMjYgMzAuNDY5M0g1Ni4xOTI5QzQ5LjIxNSA0Mi4wNTg2IDUzLjk4MzIgNTEuNjU3OCA2Mi44MjIgNTIuNzExNEM2Ny41OTAzIDM1LjczNzIgNzcuODI0NiAyMi41MDkgOTEuNDMxNiAyMi41MDlDOTkuMTA3NCAyMi41MDkgMTA1LjE1NSAyNy41NDI4IDEwNS4xNTUgMzYuNjczN0MxMDUuMTU1IDUxLjMwNjYgODYuMDgxOSA2My4yNDcxIDcxLjY2MDcgNjQuNDE3N0w2NS43Mjk1IDg1LjM3MjFDNzIuNDc0OCA5My4yMTUzIDkxLjE5OSAxMDAuODI0IDkxLjE5OSA3OS4yODQ4SDEwMi44MjlaIiBmaWxsPSIjRjVGMUVEIi8+Cjwvc3ZnPgo=",webUrl:"https://leather.io",chromeWebStoreUrl:"https://chrome.google.com/webstore/detail/hiro-wallet/ldinpeekobnhjjdofggfgjlcehhmanlj",mozillaAddOnsUrl:"https://leather.io/install-extension"},{id:"XverseProviders.BitcoinProvider",name:"Xverse Wallet",icon:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2MDAiIGhlaWdodD0iNjAwIj48ZyBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPjxwYXRoIGZpbGw9IiMxNzE3MTciIGQ9Ik0wIDBoNjAwdjYwMEgweiIvPjxwYXRoIGZpbGw9IiNGRkYiIGZpbGwtcnVsZT0ibm9uemVybyIgZD0iTTQ0MCA0MzUuNHYtNTFjMC0yLS44LTMuOS0yLjItNS4zTDIyMCAxNjIuMmE3LjYgNy42IDAgMCAwLTUuNC0yLjJoLTUxLjFjLTIuNSAwLTQuNiAyLTQuNiA0LjZ2NDcuM2MwIDIgLjggNCAyLjIgNS40bDc4LjIgNzcuOGE0LjYgNC42IDAgMCAxIDAgNi41bC03OSA3OC43Yy0xIC45LTEuNCAyLTEuNCAzLjJ2NTJjMCAyLjQgMiA0LjUgNC42IDQuNUgyNDljMi42IDAgNC42LTIgNC42LTQuNlY0MDVjMC0xLjIuNS0yLjQgMS40LTMuM2w0Mi40LTQyLjJhNC42IDQuNiAwIDAgMSA2LjQgMGw3OC43IDc4LjRhNy42IDcuNiAwIDAgMCA1LjQgMi4yaDQ3LjVjMi41IDAgNC42LTIgNC42LTQuNloiLz48cGF0aCBmaWxsPSIjRUU3QTMwIiBmaWxsLXJ1bGU9Im5vbnplcm8iIGQ9Ik0zMjUuNiAyMjcuMmg0Mi44YzIuNiAwIDQuNiAyLjEgNC42IDQuNnY0Mi42YzAgNCA1IDYuMSA4IDMuMmw1OC43LTU4LjVjLjgtLjggMS4zLTIgMS4zLTMuMnYtNTEuMmMwLTIuNi0yLTQuNi00LjYtNC42TDM4NCAxNjBjLTEuMiAwLTIuNC41LTMuMyAxLjNsLTU4LjQgNTguMWE0LjYgNC42IDAgMCAwIDMuMiA3LjhaIi8+PC9nPjwvc3ZnPg==",webUrl:"https://xverse.app",chromeWebStoreUrl:"https://chrome.google.com/webstore/detail/xverse-wallet/idnnbdplmphpflfnlkomgpfbpcgelopg",googlePlayStoreUrl:"https://play.google.com/store/apps/details?id=com.secretkeylabs.xverse",iOSAppStoreUrl:"https://apps.apple.com/app/xverse-bitcoin-web3-wallet/id1552272513",mozillaAddOnsUrl:"https://www.xverse.app/download"},{id:"AsignaProvider",name:"Asigna Multisig",icon:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMiIgaGVpZ2h0PSIzMiIgZmlsbD0ibm9uZSI+PHBhdGggZmlsbD0iIzAwMDEwMCIgZD0iTTAgMGgzMnYzMkgweiIvPjxwYXRoIGZpbGw9InVybCgjYSkiIGQ9Ik0xNS4xMSA1LjU1YTMgMyAwIDAgMC0xLjgyIDEuM2wtLjA1LjA4LS40My43Mi0uMDcuMTEtLjUuODUtLjA1LjA5LTEuMjkgMi4xOC0uMDQuMDctLjQ3LjgtLjA2LjEtLjQ2Ljc4LS4wNy4xMS0xLjYzIDIuNzYtLjA3LjExLS4zOC42Ni0uMDUuMDgtLjczIDEuMjQtLjM1LjYtLjQuNjctLjA1LjA5TDUuMSAyMC43bC0uMTEuMTgtLjE0LjIzLS4wNy4xMy0uMzMuNTUtLjA0LjA3di4wMWExLjI2IDEuMjYgMCAwIDAtLjE0LjQ3IDEuMzEgMS4zMSAwIDAgMCAxLjI0IDEuNGgxLjVsLjA1LS4wNi4wNC0uMDYuODctMS4yMS4wNS0uMDguNzctMS4wNy4wNS0uMDcuNC0uNTcuMDUtLjA2LjI0LS4zNGExLjUyIDEuNTIgMCAwIDEgMS4zOS0uNjIgMS41IDEuNSAwIDAgMSAuNjQuMiAxLjQ3IDEuNDcgMCAwIDEgLjczIDEuMjcgMS40NCAxLjQ0IDAgMCAxLS4yNy44NGwtLjYzLjg4LS4wNS4wNy0uMzIuNDUtLjA2LjA4LS4wOC4xMi0uMTIuMTYtLjA1LjA4aDIuMTNhMi4zMiAyLjMyIDAgMCAwIDEuNzctLjk2bDEuMTgtMS42My43Ny0xLjA4IDEuMy0xLjhhMS4yNCAxLjI0IDAgMCAxIC41NS0uNDNsLjA4LS4wM2ExLjMgMS4zIDAgMCAxIC4zLS4wNiAxLjI4IDEuMjggMCAwIDEgMS4xNS41NGwuMTEuMmExLjEzIDEuMTMgMCAwIDEgLjEuNDEgMS4xOSAxLjE5IDAgMCAxLS4yMy43N2wtLjAzLjA1LS41Ny44LS43Ljk4LS4yNy4zN2ExLjIyIDEuMjIgMCAwIDAtLjIuNSAxLjA1IDEuMDUgMCAwIDAtLjAyLjIzdi4wNmExLjE3IDEuMTcgMCAwIDAgLjE0LjQzbC4wMi4wNS4wNy4xYTEuNDQgMS40NCAwIDAgMCAuMS4xMWwuMDUuMDYuMDEuMDFhMS44IDEuOCAwIDAgMCAuMTQuMWMwIC4wMi4wMi4wMy4wNC4wM2ExIDEgMCAwIDAgLjA4LjA1bC4wNy4wNGExLjI1IDEuMjUgMCAwIDAgLjUuMWg2LjljLjEgMCAuMi0uMDEuMjktLjAzbC4wNi0uMDJhMS4yNyAxLjI3IDAgMCAwIC4yNy0uMS41Ny41NyAwIDAgMCAuMDctLjAzIDEuMjEgMS4yMSAwIDAgMCAuMjYtLjE5bC4wOC0uMDdhLjkyLjkyIDAgMCAwIC4xNS0uMTkgMS41NSAxLjU1IDAgMCAwIC4wOS0uMTdsLjAyLS4wNWExLjIyIDEuMjIgMCAwIDAgLjA4LS4yNnYtLjA0bC4wMi0uMDh2LS4wOGExLjMyIDEuMzIgMCAwIDAtLjItLjc0bC0xLjYtMi42NC0uMDYtLjEtLjItLjMyLS4zMy0uNTR2LS4wMWwtLjA1LS4wOC0xLjMtMi4xNS0uMDctLjEtLjA0LS4wNi0uOC0xLjMyLS4wNC0uMDctLjItLjM0LS4xLS4xNC0uMS0uMTYtLjUzLS45LS4xMy0uMi0uMDktLjE0LTIuMTctMy41Ny0uMDQtLjA3LS43Mi0xLjE5LS4wNS0uMDctLjQtLjY1YTIuNjUgMi42NSAwIDAgMC0uMy0uNCAyLjk2IDIuOTYgMCAwIDAtLjk3LS43NCAzLjA0IDMuMDQgMCAwIDAtMS4zLS4zYy0uMjUgMC0uNS4wNC0uNzQuMVoiLz48cGF0aCBmaWxsPSJ1cmwoI2IpIiBkPSJNMTkgMTYuM2E1LjQ1IDUuNDUgMCAwIDAtLjgzIDEuNTZsLS4wNC4xNWExLjM2IDEuMzYgMCAwIDEgLjI4LS4xNiAxLjI0IDEuMjQgMCAwIDEgLjM4LS4wOGguMWExLjI4IDEuMjggMCAwIDEgMS4wNS41NGMuMDQuMDYuMDguMTMuMS4yYTEuMjQgMS4yNCAwIDAgMSAuMDkuMjcgMS4xOSAxLjE5IDAgMCAxLS4yLjkxbC0uMDQuMDUtLjU3Ljc5LS43Ljk5LS4yNy4zN2ExLjIzIDEuMjMgMCAwIDAtLjIuNDIgMS4wNiAxLjA2IDAgMCAwLS4wMi4zMXYuMDZhMS4xNyAxLjE3IDAgMCAwIC4xNi40Ny45My45MyAwIDAgMCAuMDcuMSAxLjUgMS41IDAgMCAwIC4xLjEybC4wNS4wNmguMDFhMS45NCAxLjk0IDAgMCAwIC4wOS4wOCAxIDEgMCAwIDAgLjE3LjFsLjA3LjA0YTEuMjUgMS4yNSAwIDAgMCAuNS4xaDYuOWMuMSAwIC4yIDAgLjI4LS4wMmwuMDctLjAyYTEuMzIgMS4zMiAwIDAgMCAuMzQtLjEzbC4xNi0uMS4wMy0uMDNhMS4yOSAxLjI5IDAgMCAwIC4yLS4yIDIuNDMgMi40MyAwIDAgMCAuMTItLjE3Yy4wMy0uMDMuMDUtLjA4LjA3LS4xMmwuMDItLjA1YTEuMjEgMS4yMSAwIDAgMCAuMDktLjN2LS4wOGwuMDEtLjA5YTEuMzIgMS4zMiAwIDAgMC0uMi0uNzNsLTEuNi0yLjY0LS4wNi0uMS0uMi0uMzItLjMzLS41NHYtLjAybC0uMDUtLjA3LTEuMy0yLjE1LS4xMi0uMDctLjA3LS4wNGE0Ljk0IDQuOTQgMCAwIDAtMi40Ni0uNjdjLTEuMDMgMC0xLjc2LjU3LTIuMjYgMS4yWiIvPjxwYXRoIGZpbGw9IiNmZmYiIGQ9Ik0xMi4yOSAyMS4wOGMwIC4yOS0uMDkuNTgtLjI3Ljg0bC0xLjMxIDEuODRIN2wyLjUyLTMuNTNhMS41NCAxLjU0IDAgMCAxIDIuMS0uMzZjLjQzLjI4LjY2Ljc0LjY2IDEuMloiLz48cGF0aCBmaWxsPSIjMDAwIiBkPSJNMTEuMTYgMjEuMjVhLjU2LjU2IDAgMCAxLS41Ny41NS41Ni41NiAwIDAgMS0uNTctLjU2LjU2LjU2IDAgMCAxIC41Ny0uNTUuNTYuNTYgMCAwIDEgLjU3LjU2WiIvPjxkZWZzPjxsaW5lYXJHcmFkaWVudCBpZD0iYSIgeDE9IjE1LjIzIiB4Mj0iMTkuMyIgeTE9IjI1Ljc4IiB5Mj0iNi4xMSIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiPjxzdG9wIHN0b3AtY29sb3I9IiM2NTIyRjQiLz48c3RvcCBvZmZzZXQ9Ii41NSIgc3RvcC1jb2xvcj0iIzlCNkJGRiIvPjxzdG9wIG9mZnNldD0iMSIgc3RvcC1jb2xvcj0iI0E1ODVGRiIvPjwvbGluZWFyR3JhZGllbnQ+PGxpbmVhckdyYWRpZW50IGlkPSJiIiB4MT0iMjIuNTkiIHgyPSIyNC44IiB5MT0iMjQuNzEiIHkyPSIxNS41MyIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiPjxzdG9wIHN0b3AtY29sb3I9IiM0MjFGOEIiLz48c3RvcCBvZmZzZXQ9Ii41NSIgc3RvcC1jb2xvcj0iIzcyMzBGRiIvPjxzdG9wIG9mZnNldD0iMSIgc3RvcC1jb2xvcj0iIzk3NzNGRiIvPjwvbGluZWFyR3JhZGllbnQ+PC9kZWZzPjwvc3ZnPg==",webUrl:"https://asigna.io",chromeWebStoreUrl:"https://stx.asigna.io/"},{id:"FordefiProviders.UtxoProvider",name:"Fordefi",icon:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDIiIGhlaWdodD0iNDIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CiAgPHBhdGggZmlsbD0iIzEwMTExNCIgZD0iTTAgMGg0MnY0MkgweiIvPgogIDxwYXRoIGQ9Ik0xOS40NyAyNi44OUg1djMuNTdhNC41NyA0LjU3IDAgMCAwIDQuNTggNC41N2g1LjgzbDQuMDYtOC4xNFoiIGZpbGw9IiM3OTk0RkYiLz4KICA8cGF0aCBkPSJNNSAxNy40aDI3LjU4bC0zLjIgNi43OEg1VjE3LjRaIiBmaWxsPSIjNDg2REZGIi8+CiAgPHBhdGggZD0iTTE0LjY3IDdINXY3LjY4aDMzVjdoLTkuNjd2NS43NGgtMlY3aC05LjY3djUuNzRoLTEuOTlWN1oiIGZpbGw9IiM1Q0QxRkEiLz4KPC9zdmc+Cg==",webUrl:"https://www.fordefi.com/",chromeWebStoreUrl:"https://chromewebstore.google.com/detail/fordefi/hcmehenccjdmfbojapcbcofkgdpbnlle"}];var v="@stacks/connect",$e={addresses:{stx:[],btc:[]},version:"0.0.1"},Ie=e=>[...new Map(e.map(o=>[o.address,o])).values()].map(s=>{var o=ge(s,[]);return "publicKey"in o&&delete o.publicKey,"derivationPath"in o&&delete o.derivationPath,"tweakedPublicKey"in o&&delete o.tweakedPublicKey,o});function xe(e){try{let o=U()||$e,s=M(u({},o),{updatedAt:Date.now(),addresses:u(u({},o.addresses),e.addresses&&{stx:e.addresses.stx&&Ie([...o.addresses.stx,...e.addresses.stx]),btc:e.addresses.btc&&Ie([...o.addresses.btc,...e.addresses.btc])})});localStorage.setItem(v,bytesToHex(utf8ToBytes(JSON.stringify(s))));}catch(t){console.warn("Failed to store data in localStorage:",t);}}function me(){try{localStorage.removeItem(v);}catch(e){console.warn("Failed to clear localStorage:",e);}}function U(){try{let e=localStorage.getItem(v);return e?JSON.parse(bytesToUtf8(hexToBytes(e))):null}catch(e){return console.warn("Failed to get data from localStorage:",e),null}}function et(){clearSelectedProviderId(),me(),new T().store.deleteSessionData();}function tt(){let e=U();return (e==null?void 0:e.addresses.stx.length)>0||(e==null?void 0:e.addresses.btc.length)>0}async function h(e,t,o){var s;try{let n=await e.request(t,o);if("error"in n)throw I.fromResponse(n.error);return n.result}catch(n){if(n instanceof I)throw n;if("jsonrpc"in n)throw I.fromResponse(n.error);let r=(s=n.code)!=null?s:-31e3;throw new I(n.message,r,n.data,n)}}function dt(e){return e?async function(o,s,n){let r=await h(o,s,n);if((s==="getAddresses"||s==="wallet_connect")&&"addresses"in r){let{stx:i,btc:c}=At(r.addresses).reduce((d,f)=>(d[f.address.startsWith("S")?"stx":"btc"].push(f),d),{stx:[],btc:[]});xe({addresses:{stx:i,btc:c}});}return r}:h}async function P(...e){let{options:t,method:o,params:s}=ut(e),n=Object.assign({provider:getProvider(),defaultProviders:De,forceWalletSelect:!1,persistWalletSelect:!0,enableOverrides:!0,enableLocalStorage:!0},gt(t)),r=St(n.enableOverrides,dt(n.enableLocalStorage));if(n.provider&&!n.forceWalletSelect){let{method:i,params:c}=G(n.provider,o,s,n.enableOverrides);return await r(n.provider,i,Y(c))}if(typeof window!="undefined")return defineCustomElements(window),new Promise((i,c)=>{let d=document.createElement("connect-modal");d.defaultProviders=Le(n.approvedProviderIds,n.defaultProviders),d.installedProviders=Le(n.approvedProviderIds,getInstalledProviders(n.defaultProviders));let f=document.body.style.overflow;document.body.style.overflow="hidden";let a=()=>{d.remove(),document.body.style.overflow=f;};d.callback=m=>{a();let L=getProviderFromId(m),{method:y,params:j}=G(L,o,s,n.enableOverrides),_=ft(n.persistWalletSelect,m);i(r(L,y,Y(j)).then(_));},d.cancelCallback=()=>{a(),c(new I("User canceled the request",-31001));},document.body.appendChild(d);let x=m=>{m.key==="Escape"&&(document.removeEventListener("keydown",x),d.remove(),c(new I("User canceled the request",-31001)));};document.addEventListener("keydown",x);})}function ut(e){return typeof e[0]=="string"?{method:e[0],params:e[1]}:{options:e[0],method:e[1],params:e[2]}}function Le(e,t){return e?t.filter(o=>e.includes(o.id)):t}function Mt(e){let t=e&&"network"in e?{network:e.network}:void 0;return P(M(u({},e),{forceWalletSelect:!0}),"getAddresses",t)}function S(e,t,o){return (s,n)=>{if(!n)throw new Error("[Connect] No installed Stacks wallet found");let r=t(s),i=s,{method:c,params:d}=G(n,e,r);h(n,c,Y(d)).then(f=>{var x;let a=o(f);(x=i.onFinish)==null||x.call(i,a);}).catch(i.onCancel);}}function z(e){return pt(e)||lt(e)}function pt(e){return "signMultipleTransactions"in e&&"createRepeatInscriptions"in e&&!(e!=null&&e.isLeather)&&!(e!=null&&e.isFordefi)}function lt(e){return "isFordefi"in e&&!!e.isFordefi}function Ne(e){return "isLeather"in e&&!!e.isLeather}function gt(e){if(e===void 0)return {};let t={};for(let[o,s]of Object.entries(e))s!==void 0&&(t[o]=s);return t}function St(e,t){return e?async(o,s,n)=>{let r=await t(o,s,n),i=u({},r);return r!==null&&"txId"in r&&r.txId&&!("txid"in i)&&(i.txid=r.txId),r!==null&&"hex"in r&&r.hex&&typeof r.hex=="string"&&!("psbt"in i)&&(i.psbt=base64.encode(hexToBytes(r.hex))),i}:t}function G(e,t,o,s=!0){if(!s)return {method:t,params:o};if(z(e)&&["getAddresses","stx_getAddresses"].includes(t))return {method:"wallet_connect",params:o};if(z(e)&&t==="sendTransfer"){let n=M(u({},o),{recipients:o.recipients.map(r=>M(u({},r),{amount:Number(r.amount)})),network:void 0});return {method:t,params:n}}if(z(e)&&t==="signPsbt"){let n=o.signInputs;if(!n)return {method:t,params:o};let r={};for(let c of n)typeof c!="number"&&c.address&&(r[c.address]||(r[c.address]=[]),r[c.address].push(c.index));let i={psbt:o.psbt,signInputs:r,broadcast:o.broadcast};return {method:t,params:i}}if(Ne(e)&&t==="sendTransfer"){let n=M(u({},o),{recipients:o.recipients.map(r=>M(u({},r),{amount:r.amount.toString()}))});return {method:t,params:n}}if(Ne(e)&&t==="signPsbt"){let n={hex:bytesToHex(base64.decode(o.psbt)),signAtIndex:o.signInputs.map(r=>typeof r=="number"?r:r.index),allowedSighash:o.allowedSighash,broadcast:o.broadcast,network:o.network};return {method:t,params:n}}return {method:t,params:o}}var Pe=["stx-postcondition","ft-postcondition","nft-postcondition"];function Y(e){if(!e||typeof e!="object")return e;let t=u({},e);for(let[o,s]of Object.entries(e)){if(typeof s=="bigint"){t[o]=s.toString();continue}if(s){if(Array.isArray(s)){t[o]=s.map(n=>typeof n=="bigint"?n.toString():!n||typeof n!="object"||!("type"in n)?n:Pe.includes(n.type)?postConditionToHex(n):Cl.serialize(n));continue}typeof s=="object"&&"type"in s&&(t[o]=Pe.includes(s.type)?postConditionToHex(s):Cl.serialize(s));}}return t}function ft(e,t){return function(s){if(e)try{setSelectedProviderId(t);}catch(n){}return s}}function At(e){return e.slice().sort((t,o)=>{let s="purpose"in t&&t.purpose==="payment",n="purpose"in o&&o.purpose==="payment";return s&&!n?-1:!s&&n?1:0})}var vo="https://app.blockstack.org";typeof window!="undefined"&&(window.__CONNECT_VERSION__="__VERSION__");var Uo=()=>{let e=navigator.userAgent;return /android/i.test(e)||/iPad|iPhone|iPod/.test(e)?!0:/windows phone/i.test(e)},he=async(e,t)=>{var i,c,d,f,a,x;let{onFinish:o,onCancel:s,userSession:n}=e,r=Oe(n);r.isUserSignedIn()&&r.signUserOut();try{let L=await P({provider:t,forceWalletSelect:!0},"getAddresses"),y=r.store.getSessionData();(i=y.userData)!=null||(y.userData={profile:{}}),(d=(c=y.userData).profile)!=null||(c.profile={}),(a=(f=y.userData.profile).stxAddress)!=null||(f.stxAddress={mainnet:"",testnet:""});let j=L.addresses.find(A=>(A==null?void 0:A.symbol)==="STX"||A.address.startsWith("S")).address.toUpperCase(),_=j[1]==="P"||j[1]==="M";Object.assign(y.userData.profile.stxAddress,{[_?"mainnet":"testnet"]:j});let ce=(x=L.addresses.find(A=>{var de;return (de=A==null?void 0:A.address)!=null&&de.startsWith("S")?!1:A.purpose==="payment"?!0:we(A==null?void 0:A.address)?L.addresses.every(N=>{var ue;return ((ue=N==null?void 0:N.address)==null?void 0:ue.startsWith("S"))||we(N==null?void 0:N.address)}):!0}))==null?void 0:x.address;ce&&(y.userData.profile.btcAddress=ce),r.store.setSessionData(y),o==null||o({userSession:r,authResponsePayload:y.userData});}catch(m){console.error("[Connect] Error during auth request",m),s==null||s(m);}},yt="blockstack-session",O=class{constructor(t,o,s,n,r,i){}},T=class{constructor(t){t!=null&&t.appConfig&&(this.appConfig=t.appConfig),typeof window=="undefined"&&typeof self=="undefined"?this.store=new Q:this.store=new F;}makeAuthRequestToken(){}generateAndStoreTransitKey(){}getAuthResponseToken(){}isSignInPending(){return !1}isUserSignedIn(){return !!this.store.getSessionData().userData}async handlePendingSignIn(){return Promise.resolve(this.loadUserData())}loadUserData(){let t=this.store.getSessionData().userData;if(!t)throw new NoSessionDataError("No user data found. Did the user sign in?");return t}encryptContent(){}decryptContent(){}signUserOut(t){this.store.deleteSessionData(),t&&typeof location!="undefined"&&location.href&&(location.href=t);}},E=class{constructor(t){t&&this.setSessionData(t);}getSessionData(){throw new Error("Abstract class")}setSessionData(t){throw new Error("Abstract class")}deleteSessionData(){throw new Error("Abstract class")}},Q=class extends E{constructor(t){super(t),this.sessionData||this.setSessionData({});}getSessionData(){if(!this.sessionData)throw new NoSessionDataError("No session data was found.");return this.sessionData}setSessionData(t){return this.sessionData=t,!0}deleteSessionData(){return this.setSessionData({}),!0}},F=class extends E{constructor(t){var s;super(t),this.key=typeof((s=t==null?void 0:t.storeOptions)==null?void 0:s.localStorageKey)=="string"?t.storeOptions.localStorageKey:yt,localStorage.getItem(this.key)||this.setSessionData({});}getSessionData(){let t=localStorage.getItem(this.key);if(!t)throw new NoSessionDataError("No session data was found in localStorage");return JSON.parse(t)}setSessionData(t){return localStorage.setItem(this.key,JSON.stringify(t)),!0}deleteSessionData(){return localStorage.removeItem(this.key),this.setSessionData({}),!0}},Oe=e=>e||new T,zo=async e=>(e=Oe(e),e.isUserSignedIn()?Promise.resolve(e.loadUserData()):Promise.resolve(null));function we(e){let t=["bc1p","tb1p","bcrt1p"],o=[62,62,64],s=t.findIndex(n=>e.startsWith(n));return s===-1?!1:e.length===o[s]}var Dt=(s=>(s.ContractCall="contract_call",s.ContractDeploy="smart_contract",s.STXTransfer="token_transfer",s))(Dt||{}),It=(r=>(r.BUFFER="buffer",r.UINT="uint",r.INT="int",r.PRINCIPAL="principal",r.BOOL="bool",r))(It||{});var W=(r=>(r[r.DEFAULT=0]="DEFAULT",r[r.ALL=1]="ALL",r[r.NONE=2]="NONE",r[r.SINGLE=3]="SINGLE",r[r.ANYONECANPAY=128]="ANYONECANPAY",r))(W||{});function g(){return getProviderFromId(getSelectedProviderId())||window.StacksProvider||window.BlockstackProvider}function Nt(){return !!g()}function Re(e){return e?typeof e=="string"?StacksNetwork.fromName(e):"version"in e?e:"url"in e?new StacksMainnet({url:e.url}):e.transactionVersion===TransactionVersion.Mainnet?new StacksMainnet({url:e.client.baseUrl}):new StacksTestnet({url:e.client.baseUrl}):new StacksTestnet}function b(e,t){var o,s;return e instanceof t||((s=(o=e==null?void 0:e.constructor)==null?void 0:o.name)==null?void 0:s.toLowerCase())===t.name}function R(e){return e?typeof e=="string"?e:b(e,StacksMainnet)?"mainnet":b(e,StacksTestnet)?"testnet":b(e,StacksDevnet)||b(e,StacksMocknet)?"devnet":"coreApiUrl"in e?e.coreApiUrl:"url"in e?e.url:"transactionVersion"in e?e.transactionVersion===TransactionVersion.Mainnet?"mainnet":"testnet":"mainnet":"mainnet"}function D(e){if(typeof e.type=="string")return e;switch(e.type){case ClarityType.BoolFalse:return Cl.bool(!1);case ClarityType.BoolTrue:return Cl.bool(!0);case ClarityType.Int:return Cl.int(e.value);case ClarityType.UInt:return Cl.uint(e.value);case ClarityType.Buffer:return Cl.buffer(e.buffer);case ClarityType.StringASCII:return Cl.stringAscii(e.data);case ClarityType.StringUTF8:return Cl.stringUtf8(e.data);case ClarityType.List:return Cl.list(e.list.map(D));case ClarityType.Tuple:return Cl.tuple(Object.fromEntries(Object.entries(e.data).map(([o,s])=>[o,D(s)])));case ClarityType.OptionalNone:return Cl.none();case ClarityType.OptionalSome:return Cl.some(D(e.value));case ClarityType.ResponseErr:return Cl.error(D(e.value));case ClarityType.ResponseOk:return Cl.ok(D(e.value));case ClarityType.PrincipalContract:return Cl.contractPrincipal(Address.stringify(e.address),e.contractName.content);case ClarityType.PrincipalStandard:return Cl.standardPrincipal(Address.stringify(e.address));default:let t=e;throw new Error(`Unknown clarity type: ${t}`)}}function ke(e){return M(u({},e),{onFinish:void 0,onCancel:void 0})}function Pt(e){}var jt=async e=>{},wt="stx_updateProfile",X=e=>e,H=e=>e.profile;function ht(e,t=g()){S(wt,X,H)(e,t);}function Ot(e){}var Et=async e=>{},bt="stx_signMessage",V=e=>e,K=e=>e;function Rt(e,t=g()){S(bt,V,K)(e,t);}async function _t(e){}var vt="stx_signStructuredMessage",J=e=>({message:D(e.message),domain:D(e.domain)}),$=e=>e;function Ut(e,t=g()){if(e.domain.type!==ClarityType.Tuple)throw new Error("Domain must be a tuple");S(vt,J,$)(e,t);}var ze=e=>{let t=e;if(!t){let o=new O(["store_write"],document.location.href);t=new T({appConfig:o});}return t};function Yt(e){try{return ze(e).loadUserData().appPrivateKey}catch(t){return !1}}var Qt=e=>{};function Ft(e){var d;let{stxAddress:t,userSession:o,network:s}=e;if(t)return t;if(!o||!s)return;let n=(d=o==null?void 0:o.loadUserData().profile)==null?void 0:d.stxAddress,r={[ChainId.Mainnet]:"mainnet",[ChainId.Testnet]:"testnet"},i=Re(s);return n==null?void 0:n[r[i.chainId]]}var Bt=async e=>{},Wt=async e=>{},qt=async e=>{},Zt=async e=>{},Xt="stx_callContract",ee=e=>{var o;let t=(o=e.functionArgs)==null?void 0:o.map(s=>typeof s=="string"?Cl.deserialize(s):D(s)).map(s=>Cl.serialize(s));return M(u({},e),{contract:`${e.contractAddress}.${e.contractName}`,functionArgs:t,network:R(e.network),postConditionMode:Ye(e.postConditionMode),postConditions:Ge(e.postConditions),address:e.stxAddress})},te=e=>({txId:e.txid,txRaw:e.transaction,stacksTransaction:deserializeTransaction(e.transaction)});function Ht(e,t=g()){S(Xt,ee,te)(e,t);}var Vt="stx_deployContract",oe=e=>M(u({},e),{name:e.contractName,clarityCode:e.codeBody,network:R(e.network),postConditionMode:Ye(e.postConditionMode),postConditions:Ge(e.postConditions),address:e.stxAddress}),se=e=>({txId:e.txid,txRaw:e.transaction,stacksTransaction:deserializeTransaction(e.transaction)});function Kt(e,t=g()){S(Vt,oe,se)(e,t);}var Jt="stx_transferStx",ne=e=>M(u({},e),{amount:e.amount.toString(),network:R(e.network),address:e.stxAddress}),re=e=>({txId:e.txid,txRaw:e.transaction,stacksTransaction:deserializeTransaction(e.transaction)});function $t(e,t=g()){S(Jt,ne,re)(e,t);}var eo="stx_signTransaction",ie=e=>M(u({},e),{transaction:e.txHex}),ae=e=>M(u({},e),{stacksTransaction:deserializeTransaction(e.transaction)});function to(e,t=g()){S(eo,ie,ae)(e,t);}function Ge(e){if(typeof e!="undefined")return e.map(t=>typeof t=="string"?t:typeof t.type=="string"?M(u({},t),{amount:"amount"in t?t.amount.toString():void 0}):bytesToHex(serializePostCondition(t)))}function Ye(e){if(typeof e!="undefined"){if(typeof e=="string")return e;switch(e){case PostConditionMode.Allow:return "allow";case PostConditionMode.Deny:return "deny";default:let t=e;throw new Error(`Unknown post condition mode: ${t}. Should be one of: 'allow', 'deny'`)}}}function C(e,t,o){return (s,n)=>{let r=t(ke(s)),i=s;P({provider:n},e,r).then(c=>{var f;let d=o(c);(f=i.onFinish)==null||f.call(i,d);}).catch(c=>{var d;console.error(c),(d=i.onCancel)==null||d.call(i,c);});}}var oo=he,Ps=C("stx_transferStx",ne,re),js=C("stx_callContract",ee,te),ws=C("stx_deployContract",oe,se),hs=C("stx_signTransaction",ie,ae),Os=C("stx_updateProfile",X,H),Es=C("stx_signMessage",V,K),bs=C("stx_signStructuredMessage",J,$),Rs=oo;function ro(e){}var io=async e=>{},ao="signPsbt",co=e=>{var t;return {psbt:base64.encode(hexToBytes(e.hex)),signInputs:typeof e.signAtIndex=="number"?[e.signAtIndex]:e.signAtIndex,allowedSighash:(t=e.allowedSighash)==null?void 0:t.map(o=>W[o])}},uo=e=>({hex:bytesToHex(base64.decode(e.psbt))});function Mo(e,t=g()){S(ao,co,uo)(e,t);}
export{O as AppConfig,It as ContractCallArgumentType,De as DEFAULT_PROVIDERS,Q as InstanceDataStore,I as JsonRpcError,Se as JsonRpcErrorCode,yt as LOCALSTORAGE_SESSION_KEY,F as LocalStorageStore,E as SessionDataStore,W as SignatureHash,Dt as TransactionTypes,T as UserSession,he as authenticate,me as clearLocalStorage,Mt as connect,vo as defaultAuthURL,et as disconnect,Pt as getDefaultProfileUpdateRequestOptions,ro as getDefaultPsbtRequestOptions,Ot as getDefaultSignatureRequestOptions,Qt as getKeys,U as getLocalStorage,Oe as getOrCreateUserSession,g as getStacksProvider,Ft as getStxAddress,zo as getUserData,ze as getUserSession,Yt as hasAppPrivateKey,we as isAddressTaproot,tt as isConnected,Uo as isMobile,Nt as isStacksWalletInstalled,Bt as makeContractCallToken,Wt as makeContractDeployToken,jt as makeProfileUpdateToken,io as makePsbtToken,qt as makeSTXTransferToken,Zt as makeSignTransaction,Ht as openContractCall,Kt as openContractDeploy,ht as openProfileUpdateRequestPopup,Mo as openPsbtRequestPopup,$t as openSTXTransfer,to as openSignTransaction,Rt as openSignatureRequestPopup,Ut as openStructuredDataSignatureRequestPopup,P as request,h as requestRaw,Rs as showBlockstackConnect,oo as showConnect,js as showContractCall,ws as showContractDeploy,Os as showProfileUpdate,Ps as showSTXTransfer,Es as showSignMessage,bs as showSignStructuredMessage,hs as showSignTransaction,Et as signMessage,_t as signStructuredMessage};//# sourceMappingURL=index.mjs.map
//# sourceMappingURL=index.mjs.map